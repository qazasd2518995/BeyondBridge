<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeyondBridge Platform | 教育資源平台</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600;700&family=Noto+Serif+TC:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&family=Noto+Sans+TC:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 品牌主色 - 橄欖綠系列 */
            --olive-deep: #3D4A2D;
            --olive: #4A5D23;
            --olive-light: #6B7F3A;
            --olive-muted: rgba(74, 93, 35, 0.1);

            /* 輔助色 - 赤土系列 */
            --terracotta: #C17A5E;
            --terracotta-light: #D4967D;
            --terracotta-muted: rgba(193, 122, 94, 0.1);

            /* 中性色 - 奶油/沙色系列 */
            --cream: #F7F3EB;
            --cream-dark: #EDE6D6;
            --sand: #D4C5A9;
            --sage: #A8B89A;

            /* 文字色 */
            --charcoal: #2C2C2C;
            --white: #FFFFFF;
            --gray-50: #fafafa;
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #6c757d;
            --gray-600: #4A5568;
            --gray-800: #343a40;

            /* 語義色 */
            --success: #48BB78;
            --warning: #ECC94B;
            --danger: #F56565;
            --info: #4299E1;

            /* 圓角規範 */
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 20px;

            /* 陰影規範 */
            --shadow-sm: 0 2px 8px rgba(61, 74, 45, 0.06);
            --shadow-md: 0 8px 25px rgba(61, 74, 45, 0.08);
            --shadow-lg: 0 16px 40px rgba(61, 74, 45, 0.12);
            --shadow-hover: 0 12px 30px rgba(74, 93, 35, 0.15);
            --shadow-card: 0 4px 20px rgba(61, 74, 45, 0.08);

            /* 動畫規範 */
            --transition-fast: 0.15s ease;
            --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);

            /* 字體規範 */
            --font-display: 'Cormorant Garamond', 'Noto Serif TC', serif;
            --font-heading: 'Noto Serif TC', serif;
            --font-body: 'Noto Sans TC', sans-serif;

            --sidebar-width: 280px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, var(--cream) 0%, var(--cream-dark) 100%);
            color: var(--charcoal);
            line-height: 1.6;
        }

        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar - 精緻漸層設計 */
        .sidebar {
            width: var(--sidebar-width);
            background: linear-gradient(180deg, var(--olive-deep) 0%, #2D3A1F 50%, #1F2815 100%);
            color: var(--cream);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            pointer-events: none;
        }

        .sidebar-header {
            padding: 1.75rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            position: relative;
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, transparent 100%);
        }

        .sidebar-logo {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--cream);
            text-decoration: none;
            display: block;
            letter-spacing: 0.02em;
            background: linear-gradient(135deg, #fff 0%, var(--sage) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-logo span {
            display: block;
            font-family: var(--font-body);
            font-size: 0.75rem;
            font-weight: 400;
            color: var(--sage);
            margin-top: 0.35rem;
            letter-spacing: 0.05em;
            background: none;
            -webkit-text-fill-color: var(--sage);
        }

        .sidebar-nav {
            padding: 1.25rem 0;
            flex: 1;
            position: relative;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-section-title {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: rgba(168, 184, 154, 0.6);
            padding: 0.75rem 1.5rem 0.5rem;
            margin-bottom: 0.25rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            padding: 0.875rem 1.5rem;
            color: rgba(247, 243, 235, 0.75);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition-base);
            border-left: 3px solid transparent;
            position: relative;
            margin: 0.125rem 0.75rem;
            border-radius: var(--radius-md);
            border-left: none;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%) scaleY(0);
            width: 3px;
            height: 60%;
            background: linear-gradient(180deg, var(--terracotta) 0%, var(--terracotta-light) 100%);
            border-radius: 0 2px 2px 0;
            transition: var(--transition-base);
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.08);
            color: white;
            transform: translateX(4px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(193, 122, 94, 0.2) 0%, rgba(193, 122, 94, 0.1) 100%);
            color: white;
        }

        .nav-item.active::before {
            transform: translateY(-50%) scaleY(1);
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            opacity: 0.85;
            transition: var(--transition-fast);
        }

        .nav-item:hover svg {
            opacity: 1;
            transform: scale(1.1);
        }

        .nav-item.active svg {
            opacity: 1;
        }

        .nav-badge {
            margin-left: auto;
            background: linear-gradient(135deg, var(--terracotta) 0%, var(--terracotta-light) 100%);
            color: var(--cream);
            font-size: 0.7rem;
            font-weight: 600;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(193, 122, 94, 0.4);
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--terracotta);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--sage);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            min-height: 100vh;
        }

        /* Top Bar */
        .top-bar {
            background: var(--white);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 50;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--olive-deep);
        }

        .page-title span {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 400;
            font-style: italic;
            color: var(--olive-light);
            margin-left: 0.5rem;
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--gray-100);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            width: 300px;
            border: 1px solid var(--gray-200);
            transition: all 0.2s ease;
        }

        .search-box:focus-within {
            border-color: var(--olive);
            box-shadow: 0 0 0 3px rgba(74, 93, 35, 0.1);
        }

        .search-box input {
            border: none;
            background: none;
            outline: none;
            flex: 1;
            font-size: 0.9rem;
            color: var(--charcoal);
        }

        .search-box svg {
            color: var(--gray-500);
            width: 18px;
            height: 18px;
            margin-right: 0.5rem;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: none;
            background: var(--gray-100);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            position: relative;
        }

        .icon-btn:hover {
            background: var(--gray-200);
        }

        .icon-btn svg {
            width: 20px;
            height: 20px;
            color: var(--gray-500);
        }

        .notification-dot {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: var(--terracotta);
            border-radius: 50%;
        }

        /* Dashboard Content */
        .dashboard {
            padding: 2rem;
        }

        /* Stats Cards - Enhanced with animations */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--sand);
            transition: var(--transition-base);
            box-shadow: var(--shadow-card);
            position: relative;
            overflow: hidden;
            opacity: 0;
            animation: fadeSlideUp 0.5s ease forwards;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--olive), var(--terracotta));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.15s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.25s; }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
            border-color: var(--olive-light);
        }

        .stat-card:hover::before {
            transform: scaleX(1);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 52px;
            height: 52px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-base);
        }

        .stat-card:hover .stat-icon {
            transform: scale(1.1);
        }

        .stat-icon.green {
            background: linear-gradient(135deg, rgba(74, 93, 35, 0.15) 0%, rgba(74, 93, 35, 0.05) 100%);
            color: var(--olive);
        }

        .stat-icon.orange {
            background: linear-gradient(135deg, rgba(193, 122, 94, 0.15) 0%, rgba(193, 122, 94, 0.05) 100%);
            color: var(--terracotta);
        }

        .stat-icon.blue {
            background: linear-gradient(135deg, rgba(74, 124, 89, 0.15) 0%, rgba(74, 124, 89, 0.05) 100%);
            color: var(--success);
        }

        .stat-icon.sand {
            background: linear-gradient(135deg, rgba(212, 197, 169, 0.4) 0%, rgba(212, 197, 169, 0.1) 100%);
            color: var(--olive-deep);
        }

        .stat-icon svg {
            width: 24px;
            height: 24px;
        }

        .stat-trend {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.6rem;
            border-radius: 20px;
            transition: var(--transition-fast);
        }

        .stat-trend.up {
            background: linear-gradient(135deg, rgba(74, 124, 89, 0.15) 0%, rgba(74, 124, 89, 0.05) 100%);
            color: var(--success);
        }

        .stat-trend.down {
            background: linear-gradient(135deg, rgba(193, 122, 94, 0.15) 0%, rgba(193, 122, 94, 0.05) 100%);
            color: var(--terracotta);
        }

        .stat-value {
            font-family: var(--font-heading);
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--olive-deep);
            margin-bottom: 0.25rem;
            animation: countUp 0.6s ease forwards;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        /* Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        .card {
            background: var(--white);
            border-radius: var(--radius-lg);
            border: 1px solid var(--sand);
            overflow: hidden;
            box-shadow: var(--shadow-card);
            transition: var(--transition-base);
            opacity: 0;
            animation: fadeSlideUp 0.5s ease forwards;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.15s; }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--sand);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(180deg, var(--cream) 0%, var(--white) 100%);
        }

        .card-title {
            font-family: var(--font-heading);
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--olive-deep);
        }

        .card-action {
            font-size: 0.85rem;
            color: var(--olive);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .card-action:hover {
            color: var(--terracotta);
            transform: translateX(3px);
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Course List */
        .course-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .course-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--sand);
            transition: var(--transition-base);
            background: linear-gradient(135deg, var(--white) 0%, var(--cream) 100%);
            cursor: pointer;
        }

        .course-item:hover {
            border-color: var(--olive-light);
            background: linear-gradient(135deg, var(--olive-muted) 0%, var(--cream) 100%);
            transform: translateX(6px);
            box-shadow: var(--shadow-sm);
        }

        .course-thumbnail {
            width: 100px;
            height: 70px;
            border-radius: var(--radius-md);
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: var(--transition-base);
        }

        .course-item:hover .course-thumbnail {
            transform: scale(1.05);
        }

        .course-thumbnail svg {
            width: 28px;
            height: 28px;
            color: var(--cream);
        }

        .course-info {
            flex: 1;
        }

        .course-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 0.25rem;
        }

        .course-meta {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-bottom: 0.5rem;
        }

        .course-progress {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: var(--gray-200);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--olive) 0%, var(--olive-light) 100%);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--olive);
            min-width: 35px;
        }

        /* Activity List */
        .activity-list {
            display: flex;
            flex-direction: column;
        }

        .activity-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .activity-icon.complete {
            background: rgba(74, 124, 89, 0.1);
            color: var(--success);
        }

        .activity-icon.new {
            background: rgba(193, 122, 94, 0.1);
            color: var(--terracotta);
        }

        .activity-icon.update {
            background: rgba(74, 93, 35, 0.1);
            color: var(--olive);
        }

        .activity-icon svg {
            width: 18px;
            height: 18px;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            font-size: 0.9rem;
            color: var(--charcoal);
            margin-bottom: 0.25rem;
        }

        .activity-text strong {
            color: var(--olive-deep);
        }

        .activity-time {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .quick-action-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, var(--cream) 0%, var(--white) 100%);
            border: 2px solid var(--sand);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-base);
            text-decoration: none;
            color: var(--charcoal);
            position: relative;
            overflow: hidden;
        }

        .quick-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--olive), var(--terracotta));
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .quick-action-btn:hover {
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%);
            color: var(--cream);
            border-color: var(--olive);
            transform: translateX(4px);
            box-shadow: var(--shadow-sm);
        }

        .quick-action-btn:hover::before {
            transform: scaleY(1);
        }

        .quick-action-btn svg {
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }

        .quick-action-btn:hover svg {
            transform: scale(1.15);
        }

        .quick-action-btn span {
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Calendar Widget */
        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .calendar-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--charcoal);
        }

        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }

        .calendar-nav button {
            width: 28px;
            height: 28px;
            border: 1px solid var(--gray-200);
            background: var(--white);
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .calendar-nav button:hover {
            background: var(--olive);
            color: var(--cream);
            border-color: var(--olive);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            text-align: center;
        }

        .calendar-day-header {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--gray-500);
            padding: 0.5rem 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background: var(--gray-100);
        }

        .calendar-day.other-month {
            color: var(--gray-300);
        }

        .calendar-day.today {
            background: var(--olive);
            color: var(--cream);
            font-weight: 600;
        }

        .calendar-day.has-event {
            position: relative;
        }

        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 4px;
            height: 4px;
            background: var(--terracotta);
            border-radius: 50%;
        }

        /* Resource Library Page Styles */
        .library-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray-500);
        }

        .filter-select {
            padding: 0.5rem 1rem;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            background: var(--white);
            font-size: 0.9rem;
            color: var(--charcoal);
            cursor: pointer;
            min-width: 140px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--olive);
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .resource-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            border: 1px solid var(--sand);
            overflow: hidden;
            transition: var(--transition-base);
            cursor: pointer;
            box-shadow: var(--shadow-card);
            opacity: 0;
            animation: cardReveal 0.5s var(--transition-base) forwards;
            position: relative;
        }

        .resource-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--olive), var(--terracotta));
            opacity: 0;
            transition: var(--transition-base);
        }

        .resource-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-hover);
            border-color: var(--olive-light);
        }

        .resource-card:hover::before {
            opacity: 1;
        }

        /* Staggered animation for cards */
        .resource-card:nth-child(1) { animation-delay: 0.1s; }
        .resource-card:nth-child(2) { animation-delay: 0.15s; }
        .resource-card:nth-child(3) { animation-delay: 0.2s; }
        .resource-card:nth-child(4) { animation-delay: 0.25s; }
        .resource-card:nth-child(5) { animation-delay: 0.3s; }
        .resource-card:nth-child(6) { animation-delay: 0.35s; }
        .resource-card:nth-child(7) { animation-delay: 0.4s; }
        .resource-card:nth-child(8) { animation-delay: 0.45s; }
        .resource-card:nth-child(9) { animation-delay: 0.5s; }

        .resource-cover {
            height: 150px;
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 50%, var(--sage) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .resource-cover::before {
            content: '';
            position: absolute;
            inset: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .resource-cover svg {
            width: 52px;
            height: 52px;
            color: var(--cream);
            opacity: 0.9;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            transition: var(--transition-base);
        }

        .resource-card:hover .resource-cover svg {
            transform: scale(1.1);
        }

        .resource-type-badge {
            position: absolute;
            top: 0.75rem;
            left: 0.75rem;
            padding: 0.3rem 0.85rem;
            background: linear-gradient(135deg, var(--terracotta) 0%, var(--terracotta-light) 100%);
            backdrop-filter: blur(4px);
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--cream);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 2px 8px rgba(193, 122, 94, 0.3);
        }

        .resource-content {
            padding: 1.25rem;
            background: linear-gradient(180deg, var(--white) 0%, var(--cream) 100%);
        }

        .resource-title {
            font-family: var(--font-heading);
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--charcoal);
            margin-bottom: 0.5rem;
            line-height: 1.4;
            transition: var(--transition-fast);
        }

        .resource-card:hover .resource-title {
            color: var(--olive);
        }

        .resource-desc {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-bottom: 1rem;
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .resource-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .tag {
            font-size: 0.7rem;
            padding: 0.3rem 0.6rem;
            background: linear-gradient(135deg, var(--olive-muted) 0%, rgba(168, 184, 154, 0.2) 100%);
            border-radius: var(--radius-sm);
            color: var(--olive-deep);
            font-weight: 500;
            border: 1px solid rgba(74, 93, 35, 0.1);
            transition: var(--transition-fast);
        }

        .tag:hover {
            background: var(--olive);
            color: var(--cream);
        }

        .resource-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid var(--sand);
        }

        .resource-author {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .resource-author-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--cream);
            box-shadow: 0 2px 6px rgba(74, 93, 35, 0.2);
        }

        .resource-author-name {
            font-size: 0.8rem;
            color: var(--gray-600);
            font-weight: 500;
        }

        .resource-stats {
            display: flex;
            align-items: center;
            gap: 0.85rem;
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .resource-stats span {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: var(--transition-fast);
        }

        .resource-stats span:hover {
            color: var(--olive);
        }

        .resource-stats svg {
            width: 14px;
            height: 14px;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .resource-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .resource-grid {
                grid-template-columns: 1fr;
            }

            .search-box {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="appContainer" class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-logo" onclick="event.preventDefault(); showView('dashboard'); document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); document.querySelector('.nav-item[data-view=dashboard]')?.classList.add('active');">
                    BeyondBridge
                    <span>教育資源平台</span>
                </a>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">主要功能</div>
                    <a href="#" class="nav-item active">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/>
                            <polyline points="9,22 9,12 15,12 15,22"/>
                        </svg>
                        儀表板
                    </a>
                    <a href="#" class="nav-item" onclick="showView('library')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 19.5A2.5 2.5 0 016.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/>
                        </svg>
                        知識建材庫
                        <span class="nav-badge">128</span>
                    </a>
                    <a href="#" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12,2 2,7 12,12 22,7"/>
                            <polyline points="2,17 12,22 22,17"/>
                            <polyline points="2,12 12,17 22,12"/>
                        </svg>
                        我的課程
                    </a>
                    <a href="#" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        授權管理
                    </a>
                    <a href="#" class="nav-item" onclick="showView('classes')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                            <path d="M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                        共建團隊
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">學習工具</div>
                    <a href="#" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="23,7 16,12 23,17"/>
                            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                        </svg>
                        影音橋段
                    </a>
                    <a href="#" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        測驗題庫
                    </a>
                    <a href="#" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                        </svg>
                        互動討論
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">建橋者檔案</div>
                    <a href="#" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                        </svg>
                        橋樑設定
                    </a>
                    <a href="#" class="nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/>
                            <polyline points="16,17 21,12 16,7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        離開橋樑
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar">林</div>
                    <div class="user-info">
                        <div class="user-name">林老師</div>
                        <div class="user-role">資深建橋者</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <h1 class="page-title" id="pageTitle">儀表板 <span>Dashboard</span></h1>
                <div class="top-bar-actions">
                    <div class="search-box">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"/>
                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                        </svg>
                        <input type="text" placeholder="搜尋建材、橋樑...">
                    </div>
                    <button class="icon-btn" onclick="toggleNotifications()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 01-3.46 0"/>
                        </svg>
                        <span class="notification-dot"></span>
                    </button>
                </div>
            </header>

            <!-- Dashboard View -->
            <div class="dashboard" id="dashboardView">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 19.5A2.5 2.5 0 016.5 17H20"/>
                                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/>
                                </svg>
                            </div>
                            <span class="stat-trend up">+12%</span>
                        </div>
                        <div class="stat-value">24</div>
                        <div class="stat-label">已授權建材</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon orange">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="12,2 2,7 12,12 22,7"/>
                                    <polyline points="2,17 12,22 22,17"/>
                                    <polyline points="2,12 12,17 22,12"/>
                                </svg>
                            </div>
                            <span class="stat-trend up">+8%</span>
                        </div>
                        <div class="stat-value">6</div>
                        <div class="stat-label">進行中課程</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                                    <polyline points="22,4 12,14.01 9,11.01"/>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value">85%</div>
                        <div class="stat-label">平均完成率</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon sand">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12,6 12,12 16,14"/>
                                </svg>
                            </div>
                        </div>
                        <div class="stat-value">42h</div>
                        <div class="stat-label">本月學習時數</div>
                    </div>
                </div>

                <!-- Content Grid -->
                <div class="content-grid">
                    <!-- Left Column -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">進行中的課程</h2>
                            <a href="#" class="card-action">查看全部</a>
                        </div>
                        <div class="card-body">
                            <div class="course-list">
                                <div class="course-item">
                                    <div class="course-thumbnail">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polygon points="23,7 16,12 23,17"/>
                                            <rect x="1" y="5" width="15" height="14" rx="2"/>
                                        </svg>
                                    </div>
                                    <div class="course-info">
                                        <h3 class="course-title">知識建材設計基礎</h3>
                                        <p class="course-meta">12 個單元 ・ 共 8 小時</p>
                                        <div class="course-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: 75%"></div>
                                            </div>
                                            <span class="progress-text">75%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="course-item">
                                    <div class="course-thumbnail" style="background: linear-gradient(135deg, var(--terracotta) 0%, var(--terracotta-light) 100%);">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                        </svg>
                                    </div>
                                    <div class="course-info">
                                        <h3 class="course-title">互動式簡報製作技巧</h3>
                                        <p class="course-meta">8 個單元 ・ 共 5 小時</p>
                                        <div class="course-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: 40%"></div>
                                            </div>
                                            <span class="progress-text">40%</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="course-item">
                                    <div class="course-thumbnail" style="background: linear-gradient(135deg, var(--success) 0%, var(--sage) 100%);">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/>
                                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                                        </svg>
                                    </div>
                                    <div class="course-info">
                                        <h3 class="course-title">遊戲化學習設計原理</h3>
                                        <p class="course-meta">15 個單元 ・ 共 12 小時</p>
                                        <div class="course-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill" style="width: 20%"></div>
                                            </div>
                                            <span class="progress-text">20%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div>
                        <div class="card" style="margin-bottom: 1.5rem;">
                            <div class="card-header">
                                <h2 class="card-title">最近活動</h2>
                            </div>
                            <div class="card-body">
                                <div class="activity-list">
                                    <div class="activity-item">
                                        <div class="activity-icon complete">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <polyline points="20,6 9,17 4,12"/>
                                            </svg>
                                        </div>
                                        <div class="activity-content">
                                            <p class="activity-text">完成了 <strong>知識建材設計基礎</strong> 第 9 單元</p>
                                            <span class="activity-time">2 小時前</span>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon new">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                                <polyline points="14,2 14,8 20,8"/>
                                            </svg>
                                        </div>
                                        <div class="activity-content">
                                            <p class="activity-text">新增授權：<strong>國中數學建材包</strong></p>
                                            <span class="activity-time">昨天</span>
                                        </div>
                                    </div>
                                    <div class="activity-item">
                                        <div class="activity-icon update">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                                            </svg>
                                        </div>
                                        <div class="activity-content">
                                            <p class="activity-text">收到 <strong>Benjamin</strong> 的課程回饋</p>
                                            <span class="activity-time">2 天前</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">2025 年 11 月</h2>
                            </div>
                            <div class="card-body">
                                <div class="calendar-grid">
                                    <div class="calendar-day-header">日</div>
                                    <div class="calendar-day-header">一</div>
                                    <div class="calendar-day-header">二</div>
                                    <div class="calendar-day-header">三</div>
                                    <div class="calendar-day-header">四</div>
                                    <div class="calendar-day-header">五</div>
                                    <div class="calendar-day-header">六</div>

                                    <div class="calendar-day other-month">27</div>
                                    <div class="calendar-day other-month">28</div>
                                    <div class="calendar-day other-month">29</div>
                                    <div class="calendar-day other-month">30</div>
                                    <div class="calendar-day other-month">31</div>
                                    <div class="calendar-day">1</div>
                                    <div class="calendar-day">2</div>

                                    <div class="calendar-day">3</div>
                                    <div class="calendar-day">4</div>
                                    <div class="calendar-day has-event">5</div>
                                    <div class="calendar-day">6</div>
                                    <div class="calendar-day">7</div>
                                    <div class="calendar-day">8</div>
                                    <div class="calendar-day">9</div>

                                    <div class="calendar-day">10</div>
                                    <div class="calendar-day">11</div>
                                    <div class="calendar-day has-event">12</div>
                                    <div class="calendar-day">13</div>
                                    <div class="calendar-day">14</div>
                                    <div class="calendar-day">15</div>
                                    <div class="calendar-day">16</div>

                                    <div class="calendar-day">17</div>
                                    <div class="calendar-day">18</div>
                                    <div class="calendar-day">19</div>
                                    <div class="calendar-day">20</div>
                                    <div class="calendar-day">21</div>
                                    <div class="calendar-day">22</div>
                                    <div class="calendar-day">23</div>

                                    <div class="calendar-day">24</div>
                                    <div class="calendar-day">25</div>
                                    <div class="calendar-day">26</div>
                                    <div class="calendar-day">27</div>
                                    <div class="calendar-day">28</div>
                                    <div class="calendar-day">29</div>
                                    <div class="calendar-day today">30</div>
                                </div>

                                <div class="quick-actions">
                                    <a href="#" class="quick-action-btn">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="11" cy="11" r="8"/>
                                            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                                        </svg>
                                        <span>瀏覽建材</span>
                                    </a>
                                    <a href="#" class="quick-action-btn">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/>
                                        </svg>
                                        <span>聯絡顧問</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- My Courses View -->
            <div class="dashboard" id="coursesView" style="display: none;">
                <div class="page-header-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div class="page-tabs" style="margin-bottom: 0;">
                        <button class="tab-btn active" data-tab="ongoing">進行中 (3)</button>
                        <button class="tab-btn" data-tab="completed">已完成 (8)</button>
                        <button class="tab-btn" data-tab="saved">已收藏 (5)</button>
                    </div>
                    <div class="header-actions" style="display: flex; gap: 0.75rem;">
                        <button class="btn-secondary" style="padding: 0.5rem 1rem; border: 1px solid var(--gray-200); background: var(--white); border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;" onclick="showToast('正在同步學習進度...')">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
                            同步進度
                        </button>
                        <button class="btn-primary" style="padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem;" onclick="document.querySelectorAll('.nav-item')[1].click()">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            探索更多課程
                        </button>
                    </div>
                </div>
                <div class="courses-grid">
                    <div class="course-card" onclick="openCourseModal('知識建材設計基礎')">
                        <div class="course-card-cover" style="background: linear-gradient(135deg, var(--olive) 0%, var(--olive-light) 100%);">
                            <span class="course-badge">進行中</span>
                            <div class="course-play-btn"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg></div>
                        </div>
                        <div class="course-card-body">
                            <h3>知識建材設計基礎</h3>
                            <p>12 個單元 · 8 小時 · Benjamin</p>
                            <div class="course-progress"><div class="progress-bar"><div class="progress-fill" style="width:75%"></div></div><span>75%</span></div>
                        </div>
                    </div>
                    <div class="course-card" onclick="openCourseModal('互動式簡報製作技巧')">
                        <div class="course-card-cover" style="background: linear-gradient(135deg, var(--terracotta) 0%, var(--terracotta-light) 100%);">
                            <span class="course-badge">進行中</span>
                            <div class="course-play-btn"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg></div>
                        </div>
                        <div class="course-card-body">
                            <h3>互動式簡報製作技巧</h3>
                            <p>8 個單元 · 5 小時 · Mina</p>
                            <div class="course-progress"><div class="progress-bar"><div class="progress-fill" style="width:40%"></div></div><span>40%</span></div>
                        </div>
                    </div>
                    <div class="course-card" onclick="openCourseModal('遊戲化學習設計原理')">
                        <div class="course-card-cover" style="background: linear-gradient(135deg, var(--success) 0%, var(--sage) 100%);">
                            <span class="course-badge">進行中</span>
                            <div class="course-play-btn"><svg viewBox="0 0 24 24" fill="currentColor"><polygon points="5,3 19,12 5,21"/></svg></div>
                        </div>
                        <div class="course-card-body">
                            <h3>遊戲化學習設計原理</h3>
                            <p>15 個單元 · 12 小時 · Justin</p>
                            <div class="course-progress"><div class="progress-bar"><div class="progress-fill" style="width:20%"></div></div><span>20%</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- License Management View -->
            <div class="dashboard" id="licensesView" style="display: none;">
                <div class="page-header-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div style="display: flex; gap: 1rem;">
                        <button class="tab-btn active">全部授權</button>
                        <button class="tab-btn" onclick="showToast('顯示有效授權')">有效</button>
                        <button class="tab-btn" onclick="showToast('顯示即將到期')">即將到期</button>
                    </div>
                    <div class="header-actions" style="display: flex; gap: 0.75rem;">
                        <button class="btn-secondary" style="padding: 0.5rem 1rem; border: 1px solid var(--gray-200); background: var(--white); border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem;" onclick="showToast('正在匯出授權報表...')">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                            匯出報表
                        </button>
                        <button class="btn-primary" style="padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem;" onclick="showToast('已發送續約申請')">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            申請新授權
                        </button>
                    </div>
                </div>
                <div class="license-stats">
                    <div class="license-stat-card">
                        <div class="license-stat-value">24</div>
                        <div class="license-stat-label">已授權建材</div>
                    </div>
                    <div class="license-stat-card">
                        <div class="license-stat-value">3</div>
                        <div class="license-stat-label">待審核申請</div>
                    </div>
                    <div class="license-stat-card">
                        <div class="license-stat-value">2026/12</div>
                        <div class="license-stat-label">授權到期</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">授權清單</h2>
                        <button class="btn-sm" onclick="showToast('正在匯出授權報告...')">匯出報告</button>
                    </div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr><th>建材名稱</th><th>類型</th><th>授權日期</th><th>到期日</th><th>狀態</th><th>操作</th></tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>國中數學建材包</strong></td>
                                    <td><span class="tag">影音</span></td>
                                    <td>2025/11/01</td>
                                    <td>2026/10/31</td>
                                    <td><span class="status-badge active">有效</span></td>
                                    <td><button class="btn-icon" onclick="showToast('正在下載...')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg></button></td>
                                </tr>
                                <tr>
                                    <td><strong>英文文法互動模組</strong></td>
                                    <td><span class="tag">互動</span></td>
                                    <td>2025/10/15</td>
                                    <td>2026/10/14</td>
                                    <td><span class="status-badge active">有效</span></td>
                                    <td><button class="btn-icon" onclick="showToast('正在下載...')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg></button></td>
                                </tr>
                                <tr>
                                    <td><strong>企業簡報設計手冊</strong></td>
                                    <td><span class="tag">講義</span></td>
                                    <td>2025/09/20</td>
                                    <td>2025/12/19</td>
                                    <td><span class="status-badge warning">即將到期</span></td>
                                    <td><button class="btn-icon" onclick="showToast('已發送續約提醒')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 7l-7 5 7 5V7zM14 5H2a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2z"/></svg></button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Videos View - 影音橋段 -->
            <div class="dashboard" id="videosView" style="display: none;">
                <!-- Video Hero Section -->
                <div class="video-hero" style="background: linear-gradient(135deg, var(--olive-deep) 0%, var(--olive) 100%); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; color: var(--cream);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 style="font-size: 1.5rem; margin-bottom: 0.5rem;">影音學習中心</h2>
                            <p style="opacity: 0.8;">探索高品質教學影片，隨時隨地學習新知識</p>
                        </div>
                        <div style="display: flex; gap: 1rem;">
                            <div style="text-align: center; padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: 600;" id="videoCount">24</div>
                                <div style="font-size: 0.75rem; opacity: 0.8;">可觀看影片</div>
                            </div>
                            <div style="text-align: center; padding: 0.75rem 1.5rem; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                <div style="font-size: 1.5rem; font-weight: 600;">12.5h</div>
                                <div style="font-size: 0.75rem; opacity: 0.8;">總學習時數</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Video Filters -->
                <div class="video-filters" style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                    <div class="search-box" style="flex: 1; min-width: 250px; position: relative;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--gray-400);"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
                        <input type="text" id="videoSearch" placeholder="搜尋影片..." style="width: 100%; padding: 0.75rem 1rem 0.75rem 2.5rem; border: 1px solid var(--gray-200); border-radius: 8px; font-size: 0.9rem;" oninput="filterVideos()">
                    </div>
                    <select id="videoCategory" style="padding: 0.75rem 1rem; border: 1px solid var(--gray-200); border-radius: 8px; min-width: 150px;" onchange="filterVideos()">
                        <option value="">所有分類</option>
                        <option value="math">數學</option>
                        <option value="english">英文</option>
                        <option value="science">自然科學</option>
                        <option value="business">企業培訓</option>
                    </select>
                    <select id="videoDuration" style="padding: 0.75rem 1rem; border: 1px solid var(--gray-200); border-radius: 8px; min-width: 120px;" onchange="filterVideos()">
                        <option value="">影片長度</option>
                        <option value="short">10分鐘以下</option>
                        <option value="medium">10-30分鐘</option>
                        <option value="long">30分鐘以上</option>
                    </select>
                </div>

                <!-- Video Grid -->
                <div class="video-grid" id="videoGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
                    <!-- Video Card 1 -->
                    <div class="video-card" onclick="openVideoPlayer('vid001')" style="background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div class="video-thumbnail" style="position: relative; aspect-ratio: 16/9; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; align-items: center; justify-content: center;">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="var(--cream)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polygon points="10,8 16,12 10,16" fill="var(--cream)"/></svg>
                            <span style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">45:30</span>
                            <span style="position: absolute; top: 8px; left: 8px; background: var(--terracotta); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">熱門</span>
                        </div>
                        <div class="video-info" style="padding: 1rem;">
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.4;">一元二次方程式完整教學</h3>
                            <p style="font-size: 0.85rem; color: var(--gray-500); margin-bottom: 0.75rem;">從基礎概念到進階解題技巧，附帶大量練習題</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--gray-400);">
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7.5 7.5 0 0115 0"/></svg>Benjamin</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>1.2k</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>4.8</span>
                            </div>
                        </div>
                        <div class="video-progress" style="height: 3px; background: var(--gray-100);"><div style="height: 100%; width: 65%; background: var(--olive);"></div></div>
                    </div>

                    <!-- Video Card 2 -->
                    <div class="video-card" onclick="openVideoPlayer('vid002')" style="background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div class="video-thumbnail" style="position: relative; aspect-ratio: 16/9; background: linear-gradient(135deg, #2d3436 0%, #636e72 100%); display: flex; align-items: center; justify-content: center;">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="var(--cream)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polygon points="10,8 16,12 10,16" fill="var(--cream)"/></svg>
                            <span style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">32:15</span>
                        </div>
                        <div class="video-info" style="padding: 1rem;">
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.4;">英文時態完全攻略</h3>
                            <p style="font-size: 0.85rem; color: var(--gray-500); margin-bottom: 0.75rem;">12種時態一次學會，搭配實用例句練習</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--gray-400);">
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7.5 7.5 0 0115 0"/></svg>Mina</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>856</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>4.9</span>
                            </div>
                        </div>
                        <div class="video-progress" style="height: 3px; background: var(--gray-100);"><div style="height: 100%; width: 30%; background: var(--olive);"></div></div>
                    </div>

                    <!-- Video Card 3 -->
                    <div class="video-card" onclick="openVideoPlayer('vid003')" style="background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div class="video-thumbnail" style="position: relative; aspect-ratio: 16/9; background: linear-gradient(135deg, #0c0c0c 0%, #434343 100%); display: flex; align-items: center; justify-content: center;">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="var(--cream)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polygon points="10,8 16,12 10,16" fill="var(--cream)"/></svg>
                            <span style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">28:40</span>
                            <span style="position: absolute; top: 8px; left: 8px; background: var(--olive); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600;">新上架</span>
                        </div>
                        <div class="video-info" style="padding: 1rem;">
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.4;">企業簡報設計實戰</h3>
                            <p style="font-size: 0.85rem; color: var(--gray-500); margin-bottom: 0.75rem;">職場必備技能，打造專業級商務簡報</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--gray-400);">
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7.5 7.5 0 0115 0"/></svg>Justin</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>2.3k</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>4.7</span>
                            </div>
                        </div>
                        <div class="video-progress" style="height: 3px; background: var(--gray-100);"><div style="height: 100%; width: 0%; background: var(--olive);"></div></div>
                    </div>

                    <!-- Video Card 4 -->
                    <div class="video-card" onclick="openVideoPlayer('vid004')" style="background: var(--white); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;">
                        <div class="video-thumbnail" style="position: relative; aspect-ratio: 16/9; background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); display: flex; align-items: center; justify-content: center;">
                            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="var(--cream)" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polygon points="10,8 16,12 10,16" fill="var(--cream)"/></svg>
                            <span style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">52:00</span>
                        </div>
                        <div class="video-info" style="padding: 1rem;">
                            <h3 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.4;">自然科學實驗精選</h3>
                            <p style="font-size: 0.85rem; color: var(--gray-500); margin-bottom: 0.75rem;">物理化學生物實驗影片，安全又有趣</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: var(--gray-400);">
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a7.5 7.5 0 0115 0"/></svg>Benjamin</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>1.5k</span>
                                <span style="display: flex; align-items: center; gap: 4px;"><svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12,2 15.09,8.26 22,9.27 17,14.14 18.18,21.02 12,17.77 5.82,21.02 7,14.14 2,9.27 8.91,8.26"/></svg>4.6</span>
                            </div>
                        </div>
                        <div class="video-progress" style="height: 3px; background: var(--gray-100);"><div style="height: 100%; width: 100%; background: var(--olive);"></div></div>
                    </div>
                </div>
            </div>

            <!-- Quizzes View - 測驗題庫 -->
            <div class="dashboard" id="quizzesView" style="display: none;">
                <!-- Quiz Stats -->
                <div class="quiz-stats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                    <div style="background: var(--white); padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--olive);">15</div>
                        <div style="font-size: 0.85rem; color: var(--gray-500);">可用測驗</div>
                    </div>
                    <div style="background: var(--white); padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--terracotta);">8</div>
                        <div style="font-size: 0.85rem; color: var(--gray-500);">已完成</div>
                    </div>
                    <div style="background: var(--white); padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--charcoal);">85%</div>
                        <div style="font-size: 0.85rem; color: var(--gray-500);">平均分數</div>
                    </div>
                    <div style="background: var(--white); padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--sage);">12</div>
                        <div style="font-size: 0.85rem; color: var(--gray-500);">獲得徽章</div>
                    </div>
                </div>

                <!-- Quiz Tabs -->
                <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--gray-200); padding-bottom: 0.5rem;">
                    <button class="quiz-tab active" onclick="switchQuizTab(this, 'all')" style="padding: 0.5rem 1.5rem; border: none; background: var(--olive); color: var(--cream); border-radius: 20px; cursor: pointer; font-weight: 500;">全部測驗</button>
                    <button class="quiz-tab" onclick="switchQuizTab(this, 'progress')" style="padding: 0.5rem 1.5rem; border: none; background: var(--gray-100); color: var(--gray-600); border-radius: 20px; cursor: pointer;">進行中</button>
                    <button class="quiz-tab" onclick="switchQuizTab(this, 'completed')" style="padding: 0.5rem 1.5rem; border: none; background: var(--gray-100); color: var(--gray-600); border-radius: 20px; cursor: pointer;">已完成</button>
                    <button class="quiz-tab" onclick="switchQuizTab(this, 'recommended')" style="padding: 0.5rem 1.5rem; border: none; background: var(--gray-100); color: var(--gray-600); border-radius: 20px; cursor: pointer;">推薦</button>
                </div>

                <!-- Quiz List -->
                <div class="quiz-list" id="quizList">
                    <!-- Quiz Item 1 -->
                    <div class="quiz-item" style="background: var(--white); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 56px; height: 56px; background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="var(--cream)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            </div>
                            <div>
                                <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">一元二次方程式測驗</h3>
                                <p style="font-size: 0.85rem; color: var(--gray-500);">20題 · 30分鐘 · 國中數學</p>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <span class="tag" style="font-size: 0.7rem;">數學</span>
                                    <span class="tag" style="font-size: 0.7rem;">代數</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="text-align: right;">
                                <div style="font-size: 1.25rem; font-weight: 600; color: var(--olive);">92%</div>
                                <div style="font-size: 0.75rem; color: var(--gray-400);">最高分</div>
                            </div>
                            <button onclick="startQuiz('quiz001')" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
                                再次挑戰
                            </button>
                        </div>
                    </div>

                    <!-- Quiz Item 2 -->
                    <div class="quiz-item" style="background: var(--white); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 56px; height: 56px; background: linear-gradient(135deg, var(--terracotta) 0%, #a85f4d 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="var(--cream)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            </div>
                            <div>
                                <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">英文時態綜合測驗</h3>
                                <p style="font-size: 0.85rem; color: var(--gray-500);">25題 · 40分鐘 · 高中英文</p>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <span class="tag" style="font-size: 0.7rem;">英文</span>
                                    <span class="tag" style="font-size: 0.7rem;">文法</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="text-align: right;">
                                <div style="font-size: 0.85rem; color: var(--terracotta); font-weight: 500;">進行中 (60%)</div>
                                <div style="font-size: 0.75rem; color: var(--gray-400);">剩餘 10 題</div>
                            </div>
                            <button onclick="startQuiz('quiz002')" style="padding: 0.75rem 1.5rem; background: var(--terracotta); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
                                繼續作答
                            </button>
                        </div>
                    </div>

                    <!-- Quiz Item 3 -->
                    <div class="quiz-item" style="background: var(--white); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="var(--cream)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            </div>
                            <div>
                                <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">商務簡報設計認證</h3>
                                <p style="font-size: 0.85rem; color: var(--gray-500);">30題 · 45分鐘 · 企業培訓</p>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <span class="tag" style="font-size: 0.7rem;">簡報</span>
                                    <span class="tag" style="font-size: 0.7rem;">認證考試</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="text-align: right;">
                                <div style="font-size: 0.85rem; color: var(--gray-500);">尚未開始</div>
                                <div style="font-size: 0.75rem; color: var(--gray-400);">通過即獲認證</div>
                            </div>
                            <button onclick="startQuiz('quiz003')" style="padding: 0.75rem 1.5rem; background: var(--charcoal); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
                                開始測驗
                            </button>
                        </div>
                    </div>

                    <!-- Quiz Item 4 -->
                    <div class="quiz-item" style="background: var(--white); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06); display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #059669 0%, #10b981 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                <svg viewBox="0 0 24 24" width="28" height="28" fill="none" stroke="var(--cream)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            </div>
                            <div>
                                <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">自然科學實驗安全測驗</h3>
                                <p style="font-size: 0.85rem; color: var(--gray-500);">15題 · 20分鐘 · 實驗安全</p>
                                <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <span class="tag" style="font-size: 0.7rem;">自然</span>
                                    <span class="tag" style="font-size: 0.7rem;">安全規範</span>
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="text-align: right;">
                                <div style="font-size: 1.25rem; font-weight: 600; color: #059669;">100%</div>
                                <div style="font-size: 0.75rem; color: var(--gray-400);">滿分通過！</div>
                            </div>
                            <button onclick="viewQuizResult('quiz004')" style="padding: 0.75rem 1.5rem; background: var(--gray-100); color: var(--gray-600); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                查看結果
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Discussions View - 互動討論 -->
            <div class="dashboard" id="discussionsView" style="display: none;">
                <!-- Discussion Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="disc-tab active" onclick="switchDiscTab(this, 'all')" style="padding: 0.5rem 1.25rem; border: none; background: var(--olive); color: var(--cream); border-radius: 20px; cursor: pointer; font-weight: 500;">所有討論</button>
                        <button class="disc-tab" onclick="switchDiscTab(this, 'my')" style="padding: 0.5rem 1.25rem; border: none; background: var(--gray-100); color: var(--gray-600); border-radius: 20px; cursor: pointer;">我的發文</button>
                        <button class="disc-tab" onclick="switchDiscTab(this, 'popular')" style="padding: 0.5rem 1.25rem; border: none; background: var(--gray-100); color: var(--gray-600); border-radius: 20px; cursor: pointer;">熱門話題</button>
                        <button class="disc-tab" onclick="switchDiscTab(this, 'unanswered')" style="padding: 0.5rem 1.25rem; border: none; background: var(--gray-100); color: var(--gray-600); border-radius: 20px; cursor: pointer;">待回覆</button>
                    </div>
                    <button onclick="openNewPostModal()" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        發起討論
                    </button>
                </div>

                <!-- Discussion List -->
                <div class="discussion-list" id="discussionList">
                    <!-- Discussion Post 1 -->
                    <div class="discussion-post" style="background: var(--white); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="display: flex; gap: 1rem;">
                            <div style="width: 48px; height: 48px; background: var(--olive); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--cream); font-weight: 600; flex-shrink: 0;">林</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                                    <div>
                                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">如何讓探橋者更容易理解一元二次方程式？</h3>
                                        <div style="font-size: 0.8rem; color: var(--gray-400);">
                                            <span>林建橋者</span> · <span>2小時前</span> · <span class="tag" style="font-size: 0.7rem;">數學築橋</span>
                                        </div>
                                    </div>
                                    <span style="background: var(--terracotta); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">熱門</span>
                                </div>
                                <p style="color: var(--gray-600); margin-bottom: 1rem; line-height: 1.6;">最近在教一元二次方程式，發現探橋者對於因式分解和公式解的應用時機常常搞混。想請教各位建橋者有沒有什麼好的築橋方法或是建材推薦？</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; gap: 1.5rem;">
                                        <button onclick="likePost('post001')" style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3zM7 22H4a2 2 0 01-2-2v-7a2 2 0 012-2h3"/></svg>
                                            <span>24 讚</span>
                                        </button>
                                        <button onclick="toggleReplies('post001')" style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                                            <span>8 則回覆</span>
                                        </button>
                                        <button style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                                            <span>分享</span>
                                        </button>
                                    </div>
                                    <button onclick="openReplyModal('post001')" style="padding: 0.5rem 1rem; background: var(--gray-100); border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem; color: var(--gray-600);">回覆</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Discussion Post 2 -->
                    <div class="discussion-post" style="background: var(--white); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="display: flex; gap: 1rem;">
                            <div style="width: 48px; height: 48px; background: var(--terracotta); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--cream); font-weight: 600; flex-shrink: 0;">陳</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                                    <div>
                                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">推薦幾個製作互動建材的好工具</h3>
                                        <div style="font-size: 0.8rem; color: var(--gray-400);">
                                            <span>陳建橋者</span> · <span>昨天</span> · <span class="tag" style="font-size: 0.7rem;">築橋工具</span>
                                        </div>
                                    </div>
                                </div>
                                <p style="color: var(--gray-600); margin-bottom: 1rem; line-height: 1.6;">分享一下我最近使用的幾個互動建材製作工具，包括 H5P、Genially 和 Nearpod，各有優缺點...</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; gap: 1.5rem;">
                                        <button onclick="likePost('post002')" style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--olive); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="var(--olive)" stroke="var(--olive)" stroke-width="2"><path d="M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3zM7 22H4a2 2 0 01-2-2v-7a2 2 0 012-2h3"/></svg>
                                            <span>56 讚</span>
                                        </button>
                                        <button onclick="toggleReplies('post002')" style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                                            <span>15 則回覆</span>
                                        </button>
                                        <button style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                                            <span>分享</span>
                                        </button>
                                    </div>
                                    <button onclick="openReplyModal('post002')" style="padding: 0.5rem 1rem; background: var(--gray-100); border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem; color: var(--gray-600);">回覆</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Discussion Post 3 -->
                    <div class="discussion-post" style="background: var(--white); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                        <div style="display: flex; gap: 1rem;">
                            <div style="width: 48px; height: 48px; background: #6366f1; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--cream); font-weight: 600; flex-shrink: 0;">王</div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem;">
                                    <div>
                                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">企業內訓如何評估學習成效？</h3>
                                        <div style="font-size: 0.8rem; color: var(--gray-400);">
                                            <span>王主管</span> · <span>3天前</span> · <span class="tag" style="font-size: 0.7rem;">企業培訓</span>
                                        </div>
                                    </div>
                                    <span style="background: var(--olive); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">已解決</span>
                                </div>
                                <p style="color: var(--gray-600); margin-bottom: 1rem; line-height: 1.6;">公司最近導入線上學習平台，想請教各位如何有效評估員工的學習成效？除了測驗成績之外還有哪些指標可以參考？</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div style="display: flex; gap: 1.5rem;">
                                        <button onclick="likePost('post003')" style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 00-3-3l-4 9v11h11.28a2 2 0 002-1.7l1.38-9a2 2 0 00-2-2.3zM7 22H4a2 2 0 01-2-2v-7a2 2 0 012-2h3"/></svg>
                                            <span>12 讚</span>
                                        </button>
                                        <button onclick="toggleReplies('post003')" style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                                            <span>6 則回覆</span>
                                        </button>
                                        <button style="display: flex; align-items: center; gap: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 0.85rem;">
                                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                                            <span>分享</span>
                                        </button>
                                    </div>
                                    <button onclick="openReplyModal('post003')" style="padding: 0.5rem 1rem; background: var(--gray-100); border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem; color: var(--gray-600);">回覆</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Classes View - 建橋者的橋隊管理 -->
            <div class="dashboard" id="classesView" style="display: none;">
                <!-- Classes Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <p style="color: var(--gray-500); font-size: 0.9rem;">管理您搭建的橋隊與探橋者</p>
                    </div>
                    <button onclick="openCreateClassModal()" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        搭建新橋
                    </button>
                </div>

                <!-- Classes List -->
                <div class="classes-list" id="classesListContainer">
                    <!-- 橋隊卡片會由 JavaScript 動態載入 -->
                    <div style="text-align: center; padding: 4rem 2rem; color: var(--gray-400);">
                        <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                            <path d="M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">載入中...</p>
                    </div>
                </div>
            </div>

            <!-- Class Detail View - 橋隊詳情 -->
            <div class="dashboard" id="classDetailView" style="display: none;">
                <div id="classDetailContent">
                    <!-- 橋隊詳情會由 JavaScript 動態載入 -->
                </div>
            </div>

            <!-- Student Classes View - 探橋者的橋隊 -->
            <div class="dashboard" id="studentClassesView" style="display: none;">
                <!-- Student Classes Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div>
                        <p style="color: var(--gray-500); font-size: 0.9rem;">查看您已加入的橋隊和探橋進度</p>
                    </div>
                    <button onclick="openStudentJoinClassModal()" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        加入新橋隊
                    </button>
                </div>

                <!-- Enrolled Classes List -->
                <div id="studentClassesList">
                    <!-- 橋隊卡片會由 JavaScript 動態載入 -->
                    <div style="text-align: center; padding: 4rem 2rem; color: var(--gray-400);">
                        <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                            <path d="M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">載入中...</p>
                    </div>
                </div>
            </div>

            <!-- Student Join Class Modal -->
            <div id="studentJoinClassModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; align-items: center; justify-content: center;">
                <div style="width: 90%; max-width: 400px; background: var(--cream); border-radius: 16px; overflow: hidden;">
                    <div style="padding: 1.5rem 2rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="font-size: 1.2rem; font-weight: 600;">加入橋隊</h3>
                        <button onclick="closeStudentJoinClassModal()" style="background: none; border: none; cursor: pointer; padding: 0.5rem;">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                    <div style="padding: 2rem;">
                        <p style="margin-bottom: 1.25rem; color: var(--gray-600);">請輸入建橋者提供的橋樑通行碼來加入橋隊：</p>
                        <input type="text" id="studentInviteCodeInput" placeholder="例如：ABC123" maxlength="6" style="width: 100%; padding: 1rem; border: 1px solid var(--gray-200); border-radius: 8px; font-size: 1.5rem; text-align: center; letter-spacing: 0.25rem; text-transform: uppercase;">
                    </div>
                    <div style="padding: 1rem 2rem; border-top: 1px solid var(--gray-200); display: flex; justify-content: flex-end; gap: 0.75rem;">
                        <button onclick="closeStudentJoinClassModal()" style="padding: 0.75rem 1.5rem; background: var(--gray-200); border: none; border-radius: 8px; cursor: pointer;">取消</button>
                        <button onclick="submitStudentJoinClass()" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">加入橋隊</button>
                    </div>
                </div>
            </div>

            <!-- Live Support View - 即時客服 -->
            <div class="dashboard" id="consultationsView" style="display: none;">
                <!-- Chat Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <p style="color: var(--gray-500); font-size: 0.9rem;">即時線上客服，專人為您解答問題</p>
                        <div id="chatAdminStatus" style="display: flex; align-items: center; gap: 0.5rem; padding: 0.25rem 0.75rem; background: var(--gray-100); border-radius: 20px; font-size: 0.85rem;">
                            <span id="chatStatusDot" style="width: 8px; height: 8px; border-radius: 50%; background: var(--gray-400);"></span>
                            <span id="chatStatusText">檢查中...</span>
                        </div>
                    </div>
                    <button onclick="startNewChat()" id="newChatBtn" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        開始對話
                    </button>
                </div>

                <!-- Chat Container -->
                <div style="display: grid; grid-template-columns: 280px 1fr; gap: 1rem; height: calc(100vh - 220px); min-height: 500px;">
                    <!-- Chat List -->
                    <div class="card" style="overflow: hidden; display: flex; flex-direction: column;">
                        <div class="card-header" style="padding: 1rem; border-bottom: 1px solid var(--gray-200);">
                            <h3 style="font-size: 0.95rem; font-weight: 600;">對話記錄</h3>
                        </div>
                        <div id="chatRoomList" style="flex: 1; overflow-y: auto; padding: 0.5rem;">
                            <div style="text-align: center; padding: 2rem 1rem; color: var(--gray-400);">
                                <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 0.5rem; opacity: 0.5;">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                </svg>
                                <p style="font-size: 0.85rem;">尚無對話記錄</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chat Window -->
                    <div class="card" style="overflow: hidden; display: flex; flex-direction: column;">
                        <!-- Chat Window Header -->
                        <div id="chatWindowHeader" style="padding: 1rem; border-bottom: 1px solid var(--gray-200); display: none;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--olive); display: flex; align-items: center; justify-content: center;">
                                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="var(--cream)" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                    </div>
                                    <div>
                                        <h4 id="chatWindowTitle" style="font-size: 0.95rem; font-weight: 600;">客服對話</h4>
                                        <p id="chatWindowStatus" style="font-size: 0.8rem; color: var(--gray-500);">等待客服連線...</p>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 0.5rem;">
                                    <button onclick="closeChatRoom()" style="padding: 0.5rem 1rem; background: var(--gray-100); border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">結束對話</button>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Messages -->
                        <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 1rem; background: var(--gray-50);">
                            <div id="chatWelcome" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: var(--gray-400);">
                                <svg viewBox="0 0 24 24" width="80" height="80" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.3;">
                                    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
                                </svg>
                                <h3 style="font-size: 1.1rem; margin-bottom: 0.5rem; color: var(--gray-600);">歡迎使用即時客服</h3>
                                <p style="font-size: 0.9rem; max-width: 300px;">點擊「開始對話」與我們的客服人員即時交流，或選擇左側的歷史對話繼續</p>
                            </div>
                        </div>

                        <!-- Typing Indicator -->
                        <div id="typingIndicator" style="display: none; padding: 0.5rem 1rem; background: var(--gray-50); border-top: 1px solid var(--gray-100);">
                            <div style="display: flex; align-items: center; gap: 0.5rem; color: var(--gray-500); font-size: 0.85rem;">
                                <div style="display: flex; gap: 3px;">
                                    <span style="width: 6px; height: 6px; background: var(--gray-400); border-radius: 50%; animation: typing 1s infinite;"></span>
                                    <span style="width: 6px; height: 6px; background: var(--gray-400); border-radius: 50%; animation: typing 1s infinite 0.2s;"></span>
                                    <span style="width: 6px; height: 6px; background: var(--gray-400); border-radius: 50%; animation: typing 1s infinite 0.4s;"></span>
                                </div>
                                <span id="typingUser">客服正在輸入...</span>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div id="chatInputArea" style="display: none; padding: 1rem; border-top: 1px solid var(--gray-200); background: white;">
                            <div style="display: flex; gap: 0.75rem; align-items: flex-end;">
                                <div style="flex: 1; position: relative;">
                                    <textarea id="chatMessageInput" placeholder="輸入訊息..." rows="1" style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--gray-300); border-radius: 20px; font-size: 0.95rem; resize: none; max-height: 120px; line-height: 1.4;" onkeydown="handleChatKeyDown(event)" oninput="handleChatInput(this)"></textarea>
                                </div>
                                <button onclick="sendChatMessage()" id="sendMessageBtn" style="padding: 0.75rem 1.25rem; background: var(--olive); color: var(--cream); border: none; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-weight: 500;">
                                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                                    發送
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chat Rating Modal -->
            <div id="chatRatingModal" class="modal-overlay" style="display: none;" onclick="if(event.target === this) closeChatRatingModal()">
                <div class="modal" style="max-width: 400px;">
                    <div class="modal-header">
                        <h2 class="modal-title">為本次服務評分</h2>
                        <button class="modal-close" onclick="closeChatRatingModal()">&times;</button>
                    </div>
                    <div class="modal-body" style="text-align: center;">
                        <p style="margin-bottom: 1.5rem; color: var(--gray-600);">感謝您使用客服服務！請為本次服務評分：</p>
                        <div id="ratingStars" style="display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 1.5rem;">
                            <button onclick="setRating(1)" class="rating-star" data-rating="1" style="background: none; border: none; cursor: pointer; font-size: 2rem; color: var(--gray-300); transition: color 0.2s;">★</button>
                            <button onclick="setRating(2)" class="rating-star" data-rating="2" style="background: none; border: none; cursor: pointer; font-size: 2rem; color: var(--gray-300); transition: color 0.2s;">★</button>
                            <button onclick="setRating(3)" class="rating-star" data-rating="3" style="background: none; border: none; cursor: pointer; font-size: 2rem; color: var(--gray-300); transition: color 0.2s;">★</button>
                            <button onclick="setRating(4)" class="rating-star" data-rating="4" style="background: none; border: none; cursor: pointer; font-size: 2rem; color: var(--gray-300); transition: color 0.2s;">★</button>
                            <button onclick="setRating(5)" class="rating-star" data-rating="5" style="background: none; border: none; cursor: pointer; font-size: 2rem; color: var(--gray-300); transition: color 0.2s;">★</button>
                        </div>
                        <textarea id="ratingComment" placeholder="留下您的建議（選填）" rows="3" style="width: 100%; padding: 0.75rem; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 0.95rem; resize: none; margin-bottom: 1rem;"></textarea>
                    </div>
                    <div style="padding: 1rem 2rem; border-top: 1px solid var(--gray-200); display: flex; justify-content: flex-end; gap: 0.75rem;">
                        <button onclick="closeChatRatingModal()" style="padding: 0.75rem 1.5rem; background: var(--gray-200); border: none; border-radius: 8px; cursor: pointer;">略過</button>
                        <button onclick="submitRating()" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500;">提交評分</button>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div class="dashboard" id="settingsView" style="display: none;">
                <!-- Profile Banner -->
                <div class="card" style="margin-bottom: 1.5rem; background: linear-gradient(135deg, var(--olive-deep) 0%, var(--olive) 100%); color: var(--cream);">
                    <div class="card-body" style="display: flex; align-items: center; gap: 1.5rem; padding: 2rem;">
                        <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--terracotta); display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 700;">林</div>
                        <div style="flex: 1;">
                            <h2 style="font-size: 1.5rem; margin-bottom: 0.25rem;">林建橋者</h2>
                            <p style="opacity: 0.8; margin-bottom: 0.5rem;">teacher.lin@school.edu.tw</p>
                            <div style="display: flex; gap: 1.5rem; font-size: 0.85rem;">
                                <span><strong>會員等級:</strong> 專業版</span>
                                <span><strong>加入日期:</strong> 2024/01/15</span>
                                <span><strong>授權額度:</strong> 50/100</span>
                            </div>
                        </div>
                        <button class="btn-primary" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);" onclick="showToast('正在上傳大頭貼...')">變更頭像</button>
                    </div>
                </div>
                <div class="settings-grid">
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">建橋者資料</h2></div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>姓名</label>
                                <input type="text" class="form-input" id="settingsName" value="">
                            </div>
                            <div class="form-group">
                                <label>電子郵件</label>
                                <input type="email" class="form-input" id="settingsEmail" value="" disabled>
                            </div>
                            <div class="form-group">
                                <label>學校/機構</label>
                                <input type="text" class="form-input" id="settingsOrganization" value="">
                            </div>
                            <div class="form-group">
                                <label>角色</label>
                                <select class="form-input" id="settingsRole" disabled>
                                    <option value="educator">建橋者</option>
                                    <option value="trainer">橋樑工匠</option>
                                    <option value="creator">知識建築師</option>
                                    <option value="student">探橋者</option>
                                </select>
                            </div>
                            <button class="btn-primary" onclick="saveProfile()">儲存變更</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">通知設定</h2></div>
                        <div class="card-body">
                            <div class="toggle-group">
                                <label><span>新建材上架通知</span><input type="checkbox" id="notifyNewMaterial" checked><span class="toggle"></span></label>
                            </div>
                            <div class="toggle-group">
                                <label><span>課程進度提醒</span><input type="checkbox" id="notifyProgress" checked><span class="toggle"></span></label>
                            </div>
                            <div class="toggle-group">
                                <label><span>授權到期提醒</span><input type="checkbox" id="notifyExpiry" checked><span class="toggle"></span></label>
                            </div>
                            <div class="toggle-group">
                                <label><span>電子郵件通知</span><input type="checkbox" id="notifyEmail"><span class="toggle"></span></label>
                            </div>
                            <button class="btn-primary" onclick="saveNotificationSettings()">儲存通知設定</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">安全設定</h2></div>
                        <div class="card-body">
                            <div class="form-group">
                                <label>目前密碼</label>
                                <input type="password" class="form-input" id="currentPassword" placeholder="輸入目前密碼">
                            </div>
                            <div class="form-group">
                                <label>新密碼</label>
                                <input type="password" class="form-input" id="newPassword" placeholder="輸入新密碼">
                            </div>
                            <div class="form-group">
                                <label>確認新密碼</label>
                                <input type="password" class="form-input" id="confirmPassword" placeholder="再次輸入新密碼">
                            </div>
                            <button class="btn-primary" onclick="changePassword()">更新密碼</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h2 class="card-title">顯示偏好</h2></div>
                        <div class="card-body">
                            <div class="toggle-group">
                                <label><span>深色模式</span><input type="checkbox"><span class="toggle"></span></label>
                            </div>
                            <div class="toggle-group">
                                <label><span>精簡介面</span><input type="checkbox"><span class="toggle"></span></label>
                            </div>
                            <div class="form-group" style="margin-top: 1rem;">
                                <label>語言</label>
                                <select class="form-input">
                                    <option>繁體中文</option>
                                    <option>English</option>
                                    <option>日本語</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Library View (Hidden by default) -->
            <div class="dashboard" id="libraryView" style="display: none;">
                <!-- Library Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="search-box" style="width: 300px; background: var(--white);">
                            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                            <input type="text" placeholder="搜尋知識建材..." id="librarySearch">
                        </div>
                        <span style="color: var(--gray-500); font-size: 0.9rem;">找到 <strong>128</strong> 個建材</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="icon-btn" style="background: var(--olive); color: var(--cream);" title="卡片檢視"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg></button>
                        <button class="icon-btn" title="列表檢視" onclick="showToast('切換至列表檢視')"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg></button>
                        <button class="btn-primary" style="padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem;" onclick="showToast('聯繫顧問申請客製建材')"><svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>申請客製建材</button>
                    </div>
                </div>
                <div class="library-filters">
                    <div class="filter-group">
                        <span class="filter-label">科目領域</span>
                        <select class="filter-select" id="filterCategory" onchange="filterResources()">
                            <option value="">全部科目</option>
                            <option value="math">數學</option>
                            <option value="chinese">國文</option>
                            <option value="english">英文</option>
                            <option value="science">自然科學</option>
                            <option value="social">社會科學</option>
                            <option value="business">商業管理</option>
                            <option value="technology">資訊科技</option>
                            <option value="arts">藝術人文</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">適用年級</span>
                        <select class="filter-select" id="filterGradeLevel" onchange="filterResources()">
                            <option value="">全部年級</option>
                            <option value="elementary">國小</option>
                            <option value="junior">國中</option>
                            <option value="senior">高中</option>
                            <option value="university">大學</option>
                            <option value="corporate">企業培訓</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <span class="filter-label">建材類型</span>
                        <select class="filter-select" id="filterType" onchange="filterResources()">
                            <option value="">全部類型</option>
                            <option value="video">影音建材</option>
                            <option value="interactive">互動模組</option>
                            <option value="document">電子講義</option>
                            <option value="quiz">測驗題庫</option>
                        </select>
                    </div>
                </div>

                <div class="resource-grid" id="resourceGrid">
                    <!-- 教材將由 JavaScript 動態載入 -->
                    <div class="loading-placeholder" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--olive-deep);">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="animation: spin 1s linear infinite;">
                            <path d="M12 2v4m0 12v4m10-10h-4M6 12H2m15.5-7.5L15 7m-6 10l-2.5 2.5m13-2.5L17 17M7 7L4.5 4.5"/>
                        </svg>
                        <p style="margin-top: 16px;">載入教材中...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Overlay -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>

    <!-- Resource Detail Modal -->
    <div id="resourceModal" class="modal">
        <div class="modal-header">
            <h2 id="modalTitle">建材詳情</h2>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeModal()">關閉</button>
            <button class="btn-primary" onclick="addToLicense()">加入授權</button>
        </div>
    </div>

    <!-- Notification Panel -->
    <div id="notificationPanel" class="notification-panel">
        <div class="notification-header">
            <h3>通知</h3>
            <button onclick="toggleNotifications()">&times;</button>
        </div>
        <div class="notification-list">
            <div class="notification-item unread">
                <div class="notification-icon new"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/></svg></div>
                <div class="notification-content">
                    <p>新建材上架：<strong>AI 輔助築橋設計</strong></p>
                    <span>10 分鐘前</span>
                </div>
            </div>
            <div class="notification-item unread">
                <div class="notification-icon complete"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg></div>
                <div class="notification-content">
                    <p>您的授權申請已通過</p>
                    <span>1 小時前</span>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon update"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></div>
                <div class="notification-content">
                    <p>Benjamin 回覆了您的問題</p>
                    <span>昨天</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Learning Modal -->
    <div id="courseModal" class="modal course-modal">
        <div class="modal-header">
            <h2 id="courseModalTitle">課程學習</h2>
            <button class="modal-close" onclick="closeCourseModal()">&times;</button>
        </div>
        <div class="course-modal-body">
            <div class="video-placeholder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
                <p>點擊播放影片</p>
            </div>
            <div class="course-sidebar">
                <h4>課程單元</h4>
                <div class="unit-list">
                    <div class="unit-item completed"><span>1.</span> 課程簡介 <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg></div>
                    <div class="unit-item completed"><span>2.</span> 基礎概念 <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg></div>
                    <div class="unit-item active"><span>3.</span> 實作練習</div>
                    <div class="unit-item"><span>4.</span> 進階技巧</div>
                    <div class="unit-item"><span>5.</span> 案例分析</div>
                    <div class="unit-item"><span>6.</span> 總結測驗</div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Modal Styles - Enhanced with animations */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(44, 44, 44, 0.6);
            backdrop-filter: blur(4px);
            z-index: 200;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        .modal {
            display: none;
            position: relative;
            background: var(--white);
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            z-index: 201;
            box-shadow: 0 24px 64px rgba(44, 44, 44, 0.25);
            transform: scale(0.9) translateY(20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .modal.active,
        .modal-overlay.active .modal,
        .modal-overlay[style*="flex"] .modal {
            display: block;
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        /* Modal accent top bar */
        .modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--olive), var(--olive-light), var(--terracotta));
        }
        .modal-header {
            padding: 1.75rem 1.5rem 1.25rem;
            border-bottom: 1px solid var(--sand);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, var(--cream) 0%, var(--white) 100%);
        }
        .modal-header h2 {
            font-family: var(--font-heading);
            font-size: 1.3rem;
            color: var(--olive-deep);
            font-weight: 600;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-400);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }
        .modal-close:hover {
            background: var(--cream);
            color: var(--olive-deep);
            transform: rotate(90deg);
        }
        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 50vh;
        }
        .modal-footer {
            padding: 1.25rem 1.5rem;
            border-top: 1px solid var(--sand);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: var(--cream);
        }
        .modal-footer .btn-primary, .modal-footer .btn-secondary {
            padding: 0.85rem 1.75rem;
            border-radius: var(--radius-md);
            font-weight: 600;
            transition: var(--transition-base);
            cursor: pointer;
            border: none;
        }
        .modal-footer .btn-primary {
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%);
            color: var(--cream);
            box-shadow: 0 2px 8px rgba(74, 93, 35, 0.2);
        }
        .modal-footer .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 93, 35, 0.3);
        }
        .modal-footer .btn-secondary {
            background: var(--white);
            color: var(--charcoal);
            border: 2px solid var(--sand);
        }
        .modal-footer .btn-secondary:hover {
            border-color: var(--olive-light);
            background: var(--cream);
        }

        /* Notification Panel */
        .notification-panel {
            display: none;
            position: fixed;
            top: 70px;
            right: 2rem;
            width: 360px;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            z-index: 150;
        }
        .notification-panel.active { display: block; }
        .notification-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .notification-header h3 { font-size: 1rem; }
        .notification-header button { background: none; border: none; font-size: 1.25rem; cursor: pointer; }
        .notification-list { max-height: 400px; overflow-y: auto; }
        .notification-item {
            display: flex;
            gap: 1rem;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: background 0.2s;
        }
        .notification-item:hover { background: var(--gray-50); }
        .notification-item.unread { background: rgba(74, 93, 35, 0.05); }
        .notification-item .notification-icon { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .notification-item .notification-icon svg { width: 16px; height: 16px; }
        .notification-item .notification-content p { font-size: 0.9rem; margin-bottom: 0.25rem; }
        .notification-item .notification-content span { font-size: 0.75rem; color: var(--gray-500); }

        /* Course Modal */
        .course-modal { max-width: 900px; }
        .course-modal-body { display: flex; height: 500px; }
        .video-placeholder {
            flex: 2;
            background: var(--charcoal);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--cream);
            cursor: pointer;
        }
        .video-placeholder svg { width: 64px; height: 64px; margin-bottom: 1rem; }
        .course-sidebar { flex: 1; padding: 1.5rem; border-left: 1px solid var(--gray-200); overflow-y: auto; }
        .course-sidebar h4 { margin-bottom: 1rem; color: var(--olive-deep); }
        .unit-list { display: flex; flex-direction: column; gap: 0.5rem; }
        .unit-item {
            padding: 0.75rem 1rem;
            border-radius: 6px;
            background: var(--gray-100);
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        .unit-item:hover { background: var(--gray-200); }
        .unit-item.active { background: var(--olive); color: var(--cream); }
        .unit-item.completed { color: var(--success); }
        .unit-item.completed svg { width: 16px; height: 16px; margin-left: auto; }
        .unit-item span { font-weight: 600; }

        /* Search Results */
        .search-results {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .search-results.active { display: block; }
        .search-result-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .search-result-item:hover { background: var(--gray-50); }
        .search-result-item .result-icon { width: 32px; height: 32px; border-radius: 6px; background: var(--olive); display: flex; align-items: center; justify-content: center; }
        .search-result-item .result-icon svg { width: 16px; height: 16px; color: var(--cream); }
        .search-box { position: relative; }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--olive-deep);
            color: var(--cream);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 300;
            display: none;
            animation: slideIn 0.3s ease;
        }
        .toast.active { display: flex; align-items: center; gap: 0.75rem; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* ═══════════════════════════════════════════════════════════
           豐富動畫效果庫
           ═══════════════════════════════════════════════════════════ */

        /* 浮動效果 */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        /* 脈搏效果 */
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        /* 閃爍效果 */
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* 彈入效果 */
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* 淡入向上滑動 */
        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 淡入向下滑動 */
        @keyframes fadeSlideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 旋轉進入 */
        @keyframes rotateIn {
            from { transform: rotate(-180deg) scale(0); opacity: 0; }
            to { transform: rotate(0) scale(1); opacity: 1; }
        }

        /* 數字計數動畫 */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 邊框漸變動畫 */
        @keyframes borderGlow {
            0%, 100% { border-color: var(--olive); box-shadow: 0 0 5px rgba(74, 93, 35, 0.2); }
            50% { border-color: var(--terracotta); box-shadow: 0 0 15px rgba(193, 122, 94, 0.3); }
        }

        /* 背景漸變動畫 */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Page Tabs */
        .page-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            animation: fadeSlideDown 0.5s ease;
        }
        .tab-btn {
            padding: 0.75rem 1.5rem;
            border: 2px solid var(--sand);
            background: var(--white);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
        }
        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(74, 93, 35, 0.05), transparent);
            transition: left 0.5s ease;
        }
        .tab-btn:hover {
            border-color: var(--olive);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        .tab-btn:hover::before { left: 100%; }
        .tab-btn.active {
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%);
            color: var(--cream);
            border-color: var(--olive);
            box-shadow: 0 4px 12px rgba(74, 93, 35, 0.25);
        }

        /* Course Cards Grid */
        .courses-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; }
        .course-card {
            background: var(--white);
            border-radius: var(--radius-lg);
            border: 1px solid var(--sand);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition-base);
            box-shadow: var(--shadow-card);
            opacity: 0;
            animation: fadeSlideUp 0.5s ease forwards;
        }
        .course-card:nth-child(1) { animation-delay: 0.1s; }
        .course-card:nth-child(2) { animation-delay: 0.15s; }
        .course-card:nth-child(3) { animation-delay: 0.2s; }
        .course-card:nth-child(4) { animation-delay: 0.25s; }
        .course-card:nth-child(5) { animation-delay: 0.3s; }
        .course-card:nth-child(6) { animation-delay: 0.35s; }
        .course-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-hover);
            border-color: var(--olive-light);
        }
        .course-card-cover {
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .course-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            padding: 0.25rem 0.75rem;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(4px);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--cream);
        }
        .course-play-btn {
            width: 60px;
            height: 60px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--olive-deep);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .course-card:hover .course-play-btn { opacity: 1; }
        .course-play-btn svg { width: 24px; height: 24px; margin-left: 4px; }
        .course-card-body { padding: 1.25rem; }
        .course-card-body h3 { font-size: 1rem; margin-bottom: 0.5rem; color: var(--charcoal); }
        .course-card-body p { font-size: 0.85rem; color: var(--gray-500); margin-bottom: 1rem; }
        .course-card .course-progress { display: flex; align-items: center; gap: 0.75rem; }
        .course-card .course-progress span { font-size: 0.8rem; font-weight: 600; color: var(--olive); }

        /* License Stats */
        .license-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        .license-stat-card {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            border: 1px solid var(--gray-200);
        }
        .license-stat-value { font-size: 2.5rem; font-weight: 700; color: var(--olive-deep); }
        .license-stat-label { font-size: 0.9rem; color: var(--gray-500); margin-top: 0.5rem; }

        /* Data Table */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th, .data-table td { padding: 1rem; text-align: left; border-bottom: 1px solid var(--gray-200); }
        .data-table th { font-size: 0.8rem; font-weight: 600; color: var(--gray-500); text-transform: uppercase; }
        .data-table tr:hover { background: var(--gray-50); }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-badge.active { background: rgba(74, 124, 89, 0.1); color: var(--success); }
        .status-badge.warning { background: rgba(212, 165, 116, 0.2); color: #B8860B; }
        .btn-sm {
            padding: 0.5rem 1rem;
            background: var(--olive);
            color: var(--cream);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .btn-icon {
            width: 32px;
            height: 32px;
            border: 1px solid var(--gray-200);
            background: var(--white);
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .btn-icon:hover { background: var(--olive); color: var(--cream); border-color: var(--olive); }

        /* Settings */
        .settings-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-size: 0.85rem; font-weight: 500; color: var(--gray-500); margin-bottom: 0.5rem; }
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .form-input:focus { outline: none; border-color: var(--olive); box-shadow: 0 0 0 3px rgba(74, 93, 35, 0.1); }
        .toggle-group { padding: 1rem 0; border-bottom: 1px solid var(--gray-100); }
        .toggle-group label {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }
        .toggle-group input { display: none; }
        .toggle {
            width: 48px;
            height: 26px;
            background: var(--gray-200);
            border-radius: 13px;
            position: relative;
            transition: all 0.3s;
        }
        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: var(--white);
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .toggle-group input:checked + .toggle { background: var(--olive); }
        .toggle-group input:checked + .toggle::after { left: 24px; }
        .btn-primary {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%);
            color: var(--cream);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition-base);
            box-shadow: 0 2px 8px rgba(74, 93, 35, 0.2);
            position: relative;
            overflow: hidden;
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transition: left 0.5s ease;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--olive-deep) 0%, #2D3A1F 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 93, 35, 0.3);
        }
        .btn-primary:hover::before { left: 100%; }
        .btn-primary:active {
            transform: translateY(0);
        }

        /* User Menu */
        .user-menu {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: var(--olive-deep);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            overflow: hidden;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.2);
        }
        .user-menu.active { display: block; }
        .user-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--cream);
            text-decoration: none;
            font-size: 0.85rem;
            transition: background 0.2s;
            cursor: pointer;
        }
        .user-menu-item:hover { background: rgba(255,255,255,0.1); }
        .user-menu-item svg { width: 16px; height: 16px; }

        /* Calendar Events */
        .calendar-event-tooltip {
            position: absolute;
            background: var(--charcoal);
            color: var(--cream);
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 100;
            transform: translateX(-50%);
            display: none;
        }
        .calendar-day.has-event:hover .calendar-event-tooltip { display: block; }

        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            width: 40px;
            height: 40px;
            background: var(--gray-100);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }
        @media (max-width: 768px) {
            .mobile-menu-btn { display: flex; }
            .courses-grid, .settings-grid { grid-template-columns: 1fr; }
            .license-stats { grid-template-columns: 1fr; }
            .data-table { font-size: 0.8rem; }
            .data-table th, .data-table td { padding: 0.75rem 0.5rem; }
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--gray-500);
        }
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--olive);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 0.75rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes typing { 0%, 100% { opacity: 0.3; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1); } }

        /* Chat Message Styles */
        .chat-message { display: flex; margin-bottom: 1rem; animation: slideIn 0.2s ease; }
        .chat-message.user { justify-content: flex-end; }
        .chat-message.admin, .chat-message.system { justify-content: flex-start; }
        .chat-message > div { max-width: 70%; display: inline-block; }
        .chat-bubble { display: inline-block; padding: 0.75rem 1rem; border-radius: 16px; font-size: 0.95rem; line-height: 1.5; word-break: break-word; white-space: pre-wrap; }
        .chat-message.user .chat-bubble { background: var(--olive); color: var(--cream); border-bottom-right-radius: 4px; }
        .chat-message.admin .chat-bubble { background: white; color: var(--gray-800); border: 1px solid var(--gray-200); border-bottom-left-radius: 4px; }
        .chat-message.system .chat-bubble { background: var(--gray-100); color: var(--gray-500); font-size: 0.85rem; text-align: center; margin: 0 auto; }
        .chat-time { font-size: 0.75rem; color: var(--gray-400); margin-top: 0.25rem; }
        .chat-message.user .chat-time { text-align: right; }
        .chat-sender { font-size: 0.8rem; color: var(--gray-500); margin-bottom: 0.25rem; font-weight: 500; }

        /* Chat Room List Item */
        .chat-room-item { padding: 0.75rem; border-radius: 8px; cursor: pointer; transition: background 0.2s; border-bottom: 1px solid var(--gray-100); }
        .chat-room-item:hover { background: var(--gray-50); }
        .chat-room-item.active { background: var(--olive-light); border-left: 3px solid var(--olive); }
        .chat-room-item .room-title { font-weight: 500; font-size: 0.9rem; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.5rem; }
        .chat-room-item .room-preview { font-size: 0.8rem; color: var(--gray-500); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .chat-room-item .room-time { font-size: 0.75rem; color: var(--gray-400); }
        .chat-room-item .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .chat-room-item .status-dot.waiting { background: var(--warning); }
        .chat-room-item .status-dot.active { background: var(--success); }
        .chat-room-item .status-dot.closed { background: var(--gray-400); }

        /* ═══════════════════════════════════════════════════════════
           LOGIN VIEW - OLIVE GROVE GATEWAY
           Editorial split-screen with warm earthy sophistication
           ═══════════════════════════════════════════════════════════ */

        .login-view {
            display: none;
            min-height: 100vh;
            background: var(--cream);
            grid-template-columns: 1fr 1fr;
        }

        /* ─── Left Panel: Visual Gateway ─── */
        .login-visual {
            background: linear-gradient(165deg, var(--olive-deep) 0%, #2D3A1F 50%, #1F2816 100%);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem;
            overflow: hidden;
        }

        /* Grain texture overlay */
        .login-visual::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
        }

        /* Abstract bridge pathway graphic */
        .login-visual::after {
            content: '';
            position: absolute;
            width: 300%;
            height: 2px;
            background: linear-gradient(90deg,
                transparent 0%,
                var(--sage) 20%,
                var(--terracotta) 50%,
                var(--sage) 80%,
                transparent 100%);
            top: 50%;
            left: -100%;
            transform: rotate(-12deg);
            opacity: 0.4;
            animation: bridgeLine 20s linear infinite;
        }

        @keyframes bridgeLine {
            from { transform: translateX(-20%) rotate(-12deg); }
            to { transform: translateX(20%) rotate(-12deg); }
        }

        /* Floating orbs */
        .login-orb {
            position: absolute;
            border-radius: 50%;
            opacity: 0;
            animation: orbFloat 8s ease-in-out infinite, orbFadeIn 1.5s ease forwards;
        }

        .login-orb-1 {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--olive-light) 0%, transparent 70%);
            top: 10%;
            left: -10%;
            animation-delay: 0s, 0.2s;
        }

        .login-orb-2 {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, var(--terracotta) 0%, transparent 70%);
            bottom: 20%;
            right: 10%;
            animation-delay: 2s, 0.4s;
        }

        .login-orb-3 {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, var(--sage) 0%, transparent 70%);
            top: 60%;
            left: 20%;
            animation-delay: 4s, 0.6s;
        }

        @keyframes orbFloat {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(20px, -30px) scale(1.05); }
            66% { transform: translate(-10px, 20px) scale(0.95); }
        }

        @keyframes orbFadeIn {
            to { opacity: 0.3; }
        }

        /* Brand content on visual side */
        .login-visual-content {
            position: relative;
            z-index: 2;
            text-align: center;
            opacity: 0;
            animation: slideUp 1s cubic-bezier(0.16, 1, 0.3, 1) 0.3s forwards;
        }

        .login-visual-logo {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3.5rem;
            font-weight: 600;
            color: var(--cream);
            letter-spacing: -0.02em;
            margin-bottom: 1rem;
        }

        .login-visual-tagline {
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 0.75rem;
            font-weight: 400;
            letter-spacing: 0.4em;
            text-transform: uppercase;
            color: var(--sage);
            margin-bottom: 3rem;
        }

        .login-visual-quote {
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 1.5rem;
            font-weight: 300;
            color: var(--cream);
            line-height: 1.8;
            max-width: 280px;
            margin: 0 auto;
        }

        .login-visual-quote span {
            display: block;
            font-size: 0.8rem;
            color: var(--sage);
            margin-top: 1rem;
            font-weight: 400;
        }

        /* Decorative vertical line */
        .login-visual-line {
            position: absolute;
            width: 1px;
            height: 120px;
            background: linear-gradient(to bottom, transparent, var(--sage), transparent);
            bottom: 3rem;
            left: 50%;
            opacity: 0;
            animation: lineReveal 1s ease 0.8s forwards;
        }

        @keyframes lineReveal {
            to { opacity: 0.5; }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ─── Right Panel: Form Area ─── */
        .login-form-panel {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 4rem;
            position: relative;
            background: var(--cream);
        }

        /* Subtle pattern background */
        .login-form-panel::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: radial-gradient(var(--sand) 1px, transparent 1px);
            background-size: 24px 24px;
            opacity: 0.3;
            pointer-events: none;
        }

        /* Hide unused elements */
        .login-watermark,
        .geo-line,
        .float-dot,
        .login-brand {
            display: none;
        }

        /* Login card */
        .login-card {
            width: 100%;
            max-width: 420px;
            background: var(--white);
            padding: 3rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            position: relative;
            z-index: 1;
            opacity: 0;
            animation: loginCardReveal 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.5s forwards;
            transition: var(--transition-base);
            border: 1px solid rgba(212, 197, 169, 0.3);
        }

        .login-card:hover {
            box-shadow: 0 24px 48px rgba(61, 74, 45, 0.15);
            transform: translateY(-4px);
        }

        @keyframes loginCardReveal {
            from { opacity: 0; transform: translateY(40px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Terracotta accent line on card */
        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 2rem;
            right: 2rem;
            height: 4px;
            background: linear-gradient(90deg, var(--olive), var(--terracotta), var(--terracotta-light));
            border-radius: 0 0 4px 4px;
        }

        /* Decorative corner accent */
        .login-card::after {
            content: '';
            position: absolute;
            bottom: -1px;
            right: -1px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, transparent 50%, var(--cream-dark) 50%);
            border-radius: 0 0 var(--radius-xl) 0;
            opacity: 0.5;
        }

        /* Auth tabs */
        .auth-tabs {
            display: flex;
            gap: 2.5rem;
            margin-bottom: 2.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--sand);
            position: relative;
        }

        .auth-tab {
            flex: none;
            padding: 0;
            border: none;
            background: none;
            cursor: pointer;
            font-family: var(--font-heading);
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--gray-400);
            transition: all 0.3s ease;
            position: relative;
        }

        .auth-tab.active {
            color: var(--olive-deep);
        }

        .auth-tab::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--olive), var(--terracotta));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border-radius: 3px;
        }

        .auth-tab.active::after {
            transform: scaleX(1);
        }

        .auth-tab:hover:not(.active) {
            color: var(--olive-light);
            transform: translateY(-1px);
        }

        /* Welcome text - hidden */
        .login-welcome {
            display: none;
        }

        /* Form styles */
        .login-form { display: block; }
        .login-form.hidden { display: none; }

        .login-form .form-group {
            margin-bottom: 1.75rem;
            position: relative;
        }

        .login-form label {
            display: block;
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--olive-deep);
            margin-bottom: 0.6rem;
        }

        .login-form input {
            width: 100%;
            padding: 1rem 1.1rem;
            border: 2px solid var(--sand);
            border-radius: var(--radius-md);
            background: var(--cream);
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 0.95rem;
            font-weight: 400;
            color: var(--charcoal);
            transition: all 0.3s ease;
        }

        .login-form input::placeholder {
            color: var(--gray-400);
            font-weight: 300;
        }

        .login-form input:focus {
            outline: none;
            border-color: var(--olive);
            background: var(--white);
            box-shadow: 0 0 0 4px rgba(74, 93, 35, 0.1);
            transform: translateY(-1px);
        }

        .login-form input:hover:not(:focus) {
            border-color: var(--olive-light);
        }

        /* Submit button */
        .login-btn {
            width: 100%;
            padding: 1.1rem 2rem;
            background: linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%);
            color: var(--cream);
            border: none;
            border-radius: var(--radius-md);
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            margin-top: 1.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(61, 74, 45, 0.2);
        }

        .login-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s ease;
        }

        .login-btn::after {
            content: '→';
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%) translateX(-10px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            background: linear-gradient(135deg, var(--olive-deep) 0%, #2D3A1F 100%);
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(61, 74, 45, 0.3);
            padding-right: 3rem;
        }

        .login-btn:hover::before {
            left: 100%;
        }

        .login-btn:hover::after {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        .login-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(61, 74, 45, 0.25);
        }

        .login-btn:disabled {
            background: linear-gradient(135deg, var(--gray-300) 0%, var(--gray-400) 100%);
            color: var(--gray-500);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-btn:disabled::after {
            display: none;
        }

        /* Error message */
        .login-error {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.2);
            border-left: 3px solid #EF4444;
            border-radius: 4px;
            color: #DC2626;
            padding: 0.875rem 1rem;
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
            display: none;
            animation: shake 0.5s ease;
        }

        .login-error.show { display: block; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Footer */
        .login-footer {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            opacity: 0;
            animation: fadeIn 1s ease 1.2s forwards;
        }

        .login-footer p {
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 0.75rem;
            font-weight: 400;
            color: var(--gray-500);
            letter-spacing: 0.05em;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* ─── Register Form Compact Layout ─── */
        #registerForm .form-group {
            margin-bottom: 1rem;
        }

        #registerForm label {
            font-size: 0.75rem;
            margin-bottom: 0.4rem;
        }

        #registerForm input {
            padding: 0.7rem 0.875rem;
            font-size: 0.9rem;
        }

        #registerForm .login-btn {
            margin-top: 0.75rem;
            padding: 0.875rem 1.5rem;
        }

        /* Two-column row for name + email */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .form-row .form-group {
            margin-bottom: 1rem;
        }

        /* Compact invite code section */
        .invite-code-group {
            background: rgba(193, 122, 94, 0.06);
            padding: 0.75rem 1rem;
            border-radius: 4px;
            border: 1px solid rgba(193, 122, 94, 0.15);
            border-left: 3px solid var(--terracotta);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .invite-code-group label {
            color: var(--terracotta) !important;
            font-size: 0.7rem !important;
            font-weight: 600 !important;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            white-space: nowrap;
            margin-bottom: 0 !important;
            min-width: fit-content;
        }

        .invite-code-group label svg {
            stroke: var(--terracotta);
            width: 14px;
            height: 14px;
        }

        .invite-code-group input.invite-code-input {
            flex: 1;
            font-size: 1rem !important;
            letter-spacing: 0.3em !important;
            font-weight: 600 !important;
            text-transform: uppercase;
            text-align: center;
            background: var(--white) !important;
            padding: 0.6rem 0.5rem !important;
            margin: 0;
        }

        /* Hide old unused elements */
        .login-logo, .input-line { display: none; }

        /* ─── Responsive Design ─── */
        @media (max-width: 900px) {
            .login-view.active {
                grid-template-columns: 1fr;
            }

            .login-visual {
                display: none;
            }

            .login-form-panel {
                min-height: 100vh;
                padding: 2rem;
            }

            .login-card {
                padding: 2rem;
            }

            /* Show a simple header on mobile */
            .login-form-panel::after {
                content: 'BeyondBridge';
                position: absolute;
                top: 2rem;
                left: 50%;
                transform: translateX(-50%);
                font-family: 'Cormorant Garamond', serif;
                font-size: 1.5rem;
                font-weight: 600;
                color: var(--olive-deep);
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 1.5rem;
            }

            .auth-tabs {
                gap: 1.5rem;
            }

            .auth-tab {
                font-size: 1rem;
            }

            /* Stack form-row on mobile */
            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .invite-code-group {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .invite-code-group label {
                justify-content: center;
            }
        }

        /* Announcement Banner */
        .announcement-banner {
            background: linear-gradient(90deg, var(--terracotta) 0%, var(--terracotta-light) 100%);
            color: var(--white);
            padding: 0.75rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .announcement-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .announcement-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .announcement-text {
            font-size: 0.9rem;
        }
        .announcement-close {
            background: transparent;
            border: none;
            color: var(--white);
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .announcement-close:hover { opacity: 1; }
    </style>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Login View -->
    <div id="loginView" class="login-view">
        <!-- Left Panel: Visual Gateway -->
        <div class="login-visual">
            <!-- Floating Orbs -->
            <div class="login-orb login-orb-1"></div>
            <div class="login-orb login-orb-2"></div>
            <div class="login-orb login-orb-3"></div>

            <!-- Brand Content -->
            <div class="login-visual-content">
                <div class="login-visual-logo">BeyondBridge</div>
                <div class="login-visual-tagline">Build the Bridge. Go Beyond.</div>
                <div class="login-visual-quote">
                    先築橋，再超越
                    <span>— 超越之橋計畫</span>
                </div>
            </div>

            <!-- Decorative Line -->
            <div class="login-visual-line"></div>
        </div>

        <!-- Right Panel: Form Area -->
        <div class="login-form-panel">
            <!-- Login Card -->
            <div class="login-card">
                <!-- Tab Switcher -->
                <div class="auth-tabs">
                    <button type="button" class="auth-tab active" onclick="switchAuthTab('login')">登入</button>
                    <button type="button" class="auth-tab" onclick="switchAuthTab('register')">註冊</button>
                </div>

                <div id="loginError" class="login-error"></div>

                <!-- Login Form -->
                <form id="loginForm" class="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>電子郵件</label>
                        <input type="email" id="loginEmail" placeholder="your@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>密碼</label>
                        <input type="password" id="loginPassword" placeholder="請輸入密碼" required>
                    </div>
                    <button type="submit" class="login-btn">踏上橋樑</button>
                </form>

                <!-- Register Form (Student Only) -->
                <form id="registerForm" class="login-form" onsubmit="handleRegister(event)" style="display: none;">
                    <!-- Hidden role field (always student) -->
                    <input type="hidden" id="registerRole" value="student">

                    <!-- Invite Code - Inline compact style -->
                    <div class="invite-code-group">
                        <label>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
                            通行碼
                        </label>
                        <input type="text" id="registerInviteCode" placeholder="ABC123" maxlength="6" class="invite-code-input">
                    </div>

                    <!-- Name + Email in 2 columns -->
                    <div class="form-row">
                        <div class="form-group">
                            <label>姓名</label>
                            <input type="text" id="registerName" placeholder="您的姓名" required>
                        </div>
                        <div class="form-group">
                            <label>電子郵件</label>
                            <input type="email" id="registerEmail" placeholder="email@example.com" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>密碼</label>
                        <input type="password" id="registerPassword" placeholder="至少6個字元" required minlength="6">
                    </div>

                    <button type="submit" class="login-btn">開始探索</button>
                </form>
            </div>

            <!-- Footer -->
            <div class="login-footer">
                <p>&copy; 2025 BeyondBridge Education Co. All Rights Reserved.</p>
            </div>
        </div>
    </div>

    <script>
        // Page titles mapping
        const pageTitles = {
            'dashboard': '建橋總覽 <span>Bridge Overview</span>',
            'library': '知識建材庫 <span>Knowledge Materials</span>',
            'courses': '我的橋樑 <span>My Bridges</span>',
            'licenses': '建材授權 <span>Material Licenses</span>',
            'videos': '影音橋段 <span>Video Segments</span>',
            'quizzes': '橋樑驗收 <span>Bridge Inspection</span>',
            'discussions': '共建論壇 <span>Co-Build Forum</span>',
            'consultations': '即時客服 <span>Live Support</span>',
            'classes': '共建團隊 <span>Build Teams</span>',
            'studentClasses': '我的橋隊 <span>My Bridge Team</span>',
            'classDetail': '團隊詳情 <span>Team Detail</span>',
            'settings': '橋樑設定 <span>Bridge Settings</span>'
        };

        // Resources data - 動態從 API 載入
        let resources = [];

        // 教材類型標籤
        const typeLabels = {
            video: '影音',
            interactive: '互動',
            document: '講義',
            quiz: '題庫'
        };

        // 教材分類標籤
        const categoryLabels = {
            math: '數學',
            chinese: '國文',
            english: '英文',
            science: '自然科學',
            social: '社會科學',
            business: '商業管理',
            technology: '資訊科技',
            arts: '藝術人文'
        };

        // 適用年級標籤
        const gradeLevelLabels = {
            elementary: '國小',
            junior: '國中',
            senior: '高中',
            university: '大學',
            corporate: '企業培訓'
        };

        // 類型對應背景色
        const typeColors = {
            video: 'linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%)',
            interactive: 'linear-gradient(135deg, var(--terracotta) 0%, var(--terracotta-light) 100%)',
            document: 'linear-gradient(135deg, var(--success) 0%, var(--sage) 100%)',
            quiz: 'linear-gradient(135deg, #5C6BC0 0%, #7986CB 100%)'
        };

        // 類型對應圖示
        const typeIcons = {
            video: '<polygon points="23,7 16,12 23,17"/><rect x="1" y="5" width="15" height="14" rx="2"/>',
            interactive: '<rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/>',
            document: '<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>',
            quiz: '<circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/>'
        };

        // 格式化瀏覽數
        function formatViewCount(count) {
            if (!count) return '0';
            if (count >= 1000) {
                return (count / 1000).toFixed(1) + 'k';
            }
            return count.toString();
        }

        // 載入教材資源
        async function loadResources() {
            const grid = document.getElementById('resourceGrid');
            try {
                const result = await API.resources.list({ status: 'published', limit: 50 });
                if (result.success && result.data.length > 0) {
                    resources = result.data;
                    renderResourceCards(result.data);
                } else {
                    grid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--olive-deep);">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.5;">
                                <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            <p style="margin-top: 16px; font-size: 16px;">目前沒有已發布的教材</p>
                            <p style="margin-top: 8px; color: var(--gray-500);">敬請期待更多優質內容</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Load resources error:', error);
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--terracotta);">
                        <p>載入教材時發生錯誤，請稍後再試</p>
                    </div>
                `;
            }
        }

        // 渲染教材卡片
        function renderResourceCards(resourceList) {
            const grid = document.getElementById('resourceGrid');
            if (!resourceList || resourceList.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--olive-deep);">
                        <p>沒有找到符合條件的教材</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = resourceList.map(r => {
                const typeLabel = typeLabels[r.type] || r.type;
                const bgColor = typeColors[r.type] || typeColors.video;
                const icon = typeIcons[r.type] || typeIcons.video;
                const authorName = r.authorName || r.authorId || '未知作者';
                const authorInitial = authorName.charAt(0).toUpperCase();

                // 建立標籤（結合 tags、category、gradeLevel）
                const tags = [];
                if (r.gradeLevel && gradeLevelLabels[r.gradeLevel]) {
                    tags.push(gradeLevelLabels[r.gradeLevel]);
                }
                if (r.category && categoryLabels[r.category]) {
                    tags.push(categoryLabels[r.category]);
                }
                if (r.tags && Array.isArray(r.tags)) {
                    tags.push(...r.tags.slice(0, 2)); // 最多加 2 個自訂標籤
                }

                return `
                    <div class="resource-card" onclick="openResourceModal('${r.resourceId}')">
                        <div class="resource-cover" style="background: ${bgColor};">
                            <span class="resource-type-badge">${typeLabel}</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                ${icon}
                            </svg>
                        </div>
                        <div class="resource-content">
                            <h3 class="resource-title">${r.title || '未命名教材'}</h3>
                            <p class="resource-desc">${r.description || '暫無描述'}</p>
                            <div class="resource-tags">
                                ${tags.slice(0, 3).map(t => `<span class="tag">${t}</span>`).join('')}
                            </div>
                            <div class="resource-footer">
                                <div class="resource-author">
                                    <div class="resource-author-avatar">${authorInitial}</div>
                                    <span class="resource-author-name">${authorName}</span>
                                </div>
                                <div class="resource-stats">
                                    <span>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                            <circle cx="12" cy="12" r="3"/>
                                        </svg>
                                        ${formatViewCount(r.viewCount)}
                                    </span>
                                    <span>
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                                        </svg>
                                        ${r.rating ? r.rating.toFixed(1) : '-'}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // 篩選教材
        function filterResources() {
            const categoryFilter = document.getElementById('filterCategory')?.value || '';
            const gradeLevelFilter = document.getElementById('filterGradeLevel')?.value || '';
            const typeFilter = document.getElementById('filterType')?.value || '';

            let filtered = resources;

            if (categoryFilter) {
                filtered = filtered.filter(r => r.category === categoryFilter);
            }
            if (gradeLevelFilter) {
                filtered = filtered.filter(r => r.gradeLevel === gradeLevelFilter);
            }
            if (typeFilter) {
                filtered = filtered.filter(r => r.type === typeFilter);
            }

            renderResourceCards(filtered);

            // 顯示篩選結果訊息
            const totalFilters = [categoryFilter, gradeLevelFilter, typeFilter].filter(f => f).length;
            if (totalFilters > 0) {
                showToast(`找到 ${filtered.length} 筆符合條件的教材`);
            }
        }

        // Show different views
        function showView(viewName) {
            document.querySelectorAll('.dashboard').forEach(v => v.style.display = 'none');

            const viewMap = {
                'dashboard': 'dashboardView',
                'library': 'libraryView',
                'courses': 'coursesView',
                'licenses': 'licensesView',
                'videos': 'videosView',
                'quizzes': 'quizzesView',
                'discussions': 'discussionsView',
                'consultations': 'consultationsView',
                'classes': 'classesView',
                'studentClasses': 'studentClassesView',
                'classDetail': 'classDetailView',
                'settings': 'settingsView'
            };

            const viewId = viewMap[viewName] || 'dashboardView';
            const viewElement = document.getElementById(viewId);
            if (viewElement) {
                viewElement.style.display = 'block';
            } else {
                document.getElementById('dashboardView').style.display = 'block';
                if (viewName !== 'logout') {
                    showToast('此功能正在開發中...');
                }
            }

            if (viewName === 'logout') {
                if (typeof App !== 'undefined') {
                    App.logout();
                } else {
                    showToast('已離開橋樑');
                    localStorage.clear();
                    setTimeout(() => window.location.href = '../website/index.html', 1500);
                }
                return;
            }

            document.getElementById('pageTitle').innerHTML = pageTitles[viewName] || pageTitles['dashboard'];
        }

        // 導航到指定頁面並更新 active 狀態
        function navigateTo(element, viewName) {
            event.preventDefault();
            // 移除所有 nav-item 的 active 狀態
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            // 設定當前項目為 active
            element.classList.add('active');
            // 顯示對應視圖
            showView(viewName);
        }

        // Modal functions
        let currentResourceId = null;

        function openResourceModal(resourceId) {
            const resource = resources.find(r => r.resourceId === resourceId);
            if (!resource) {
                showToast('找不到該教材');
                return;
            }

            currentResourceId = resourceId;
            const typeLabel = typeLabels[resource.type] || resource.type;
            const categoryLabel = categoryLabels[resource.category] || resource.category;
            const gradeLevelLabel = gradeLevelLabels[resource.gradeLevel] || resource.gradeLevel;
            const authorName = resource.authorName || resource.authorId || '未知作者';

            // 建立標籤
            const tags = [];
            if (gradeLevelLabel) tags.push(gradeLevelLabel);
            if (categoryLabel) tags.push(categoryLabel);
            if (resource.tags && Array.isArray(resource.tags)) {
                tags.push(...resource.tags);
            }

            document.getElementById('modalTitle').textContent = resource.title || '教材詳情';
            document.getElementById('modalBody').innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <span class="tag" style="background: var(--olive); color: var(--cream);">${typeLabel}</span>
                    ${tags.map(t => `<span class="tag">${t}</span>`).join(' ')}
                </div>
                <p style="margin-bottom: 1rem; color: var(--gray-500);">${resource.description || '暫無描述'}</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                    <div><strong>作者：</strong>${authorName}</div>
                    <div><strong>觀看：</strong>${formatViewCount(resource.viewCount)}</div>
                    <div><strong>評分：</strong>${resource.rating ? resource.rating.toFixed(1) : '-'}</div>
                    ${resource.duration ? `<div><strong>時長：</strong>${resource.duration} 分鐘</div>` : ''}
                    ${resource.unitCount ? `<div><strong>單元數：</strong>${resource.unitCount} 個</div>` : ''}
                </div>
                <div style="background: var(--gray-100); padding: 1rem; border-radius: 8px;">
                    <h4 style="margin-bottom: 0.5rem;">教材資訊</h4>
                    <ul style="margin-left: 1.5rem; color: var(--gray-500);">
                        <li>類型：${typeLabel}</li>
                        <li>分類：${categoryLabel}</li>
                        <li>適用年級：${gradeLevelLabel}</li>
                        ${resource.pricingModel === 'free' ? '<li>免費教材</li>' : '<li>需取得授權</li>'}
                    </ul>
                </div>
            `;
            document.getElementById('modalOverlay').classList.add('active');
            document.getElementById('resourceModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            document.getElementById('resourceModal').classList.remove('active');
        }

        function addToLicense() {
            closeModal();
            showToast('已加入授權清單！');
        }

        // Course modal
        function openCourseModal(title) {
            document.getElementById('courseModalTitle').textContent = title;
            document.getElementById('modalOverlay').classList.add('active');
            document.getElementById('courseModal').classList.add('active');
        }

        function closeCourseModal() {
            document.getElementById('modalOverlay').classList.remove('active');
            document.getElementById('courseModal').classList.remove('active');
        }

        // Notification panel
        function toggleNotifications() {
            document.getElementById('notificationPanel').classList.toggle('active');
        }

        // Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20,6 9,17 4,12"/></svg> ${message}`;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // ========== 影音橋段功能 ==========

        // 影片資料（實際上應從 API 載入）
        const videoData = {
            'vid001': {
                title: '一元二次方程式完整教學',
                author: 'Benjamin',
                duration: '45:30',
                views: '1.2k',
                youtubeId: 'dQw4w9WgXcQ', // 示範用 YouTube ID
                description: '從基礎概念到進階應用，完整講解一元二次方程式的解法與應用。',
                progress: 65
            },
            'vid002': {
                title: '英文時態大全：12種時態一次學會',
                author: 'Mina',
                duration: '32:15',
                views: '856',
                youtubeId: 'dQw4w9WgXcQ',
                description: '系統性整理英文12種時態，搭配實例輕鬆理解。',
                progress: 30
            },
            'vid003': {
                title: '物理實驗技巧：力學篇',
                author: 'Benjamin',
                duration: '28:40',
                views: '543',
                youtubeId: 'dQw4w9WgXcQ',
                description: '實驗操作技巧與數據分析方法詳解。',
                progress: 0
            },
            'vid004': {
                title: '程式設計入門：Python 基礎',
                author: 'Justin',
                duration: '52:00',
                views: '2.1k',
                youtubeId: 'dQw4w9WgXcQ',
                description: 'Python 程式設計基礎，從零開始學習程式邏輯。',
                progress: 100
            }
        };

        let currentVideo = null;
        let videoProgressInterval = null;

        function openVideoPlayer(videoId, videoUrl) {
            const video = videoData[videoId] || {
                title: '未知影片',
                author: '未知作者',
                duration: '--:--',
                views: '--',
                youtubeId: null,
                description: '',
                progress: 0
            };

            currentVideo = { id: videoId, ...video };

            // 創建影片播放 Modal
            const modal = document.createElement('div');
            modal.id = 'videoPlayerModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:10000;display:flex;flex-direction:column;';

            // 判斷影片來源
            let playerContent = '';
            if (video.youtubeId) {
                // YouTube 嵌入
                playerContent = `
                    <iframe
                        id="videoFrame"
                        src="https://www.youtube.com/embed/${video.youtubeId}?autoplay=1&enablejsapi=1&start=${Math.floor(video.progress * 27.3)}"
                        style="width:100%;height:100%;border:none;"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen>
                    </iframe>
                `;
            } else if (videoUrl) {
                // HTML5 Video
                playerContent = `
                    <video id="videoElement" controls autoplay style="width:100%;height:100%;">
                        <source src="${videoUrl}" type="video/mp4">
                        您的瀏覽器不支援 HTML5 影片播放。
                    </video>
                `;
            } else {
                // 佔位符
                playerContent = `
                    <div style="display:flex;align-items:center;justify-content:center;width:100%;height:100%;color:var(--cream);text-align:center;">
                        <div>
                            <svg viewBox="0 0 24 24" width="80" height="80" fill="none" stroke="currentColor" stroke-width="1">
                                <circle cx="12" cy="12" r="10"/>
                                <polygon points="10,8 16,12 10,16" fill="currentColor"/>
                            </svg>
                            <p style="margin-top:1rem;font-size:1.2rem;">影片載入中...</p>
                            <p style="font-size:0.9rem;opacity:0.7;">請稍候或重新整理頁面</p>
                        </div>
                    </div>
                `;
            }

            modal.innerHTML = `
                <!-- 頂部工具列 -->
                <div style="padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.8);">
                    <div style="display:flex;align-items:center;gap:1rem;">
                        <button onclick="closeVideoPlayer()" style="background:none;border:none;color:var(--cream);cursor:pointer;display:flex;align-items:center;gap:0.5rem;padding:0.5rem;">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                            返回
                        </button>
                        <span style="color:var(--cream);opacity:0.6;">|</span>
                        <span style="color:var(--cream);font-weight:500;">${video.title}</span>
                    </div>
                    <div style="display:flex;align-items:center;gap:1rem;">
                        <span style="color:var(--cream);opacity:0.7;font-size:0.9rem;">${video.author} · ${video.duration}</span>
                        <button onclick="toggleVideoFullscreen()" style="background:none;border:none;color:var(--cream);cursor:pointer;padding:0.5rem;" title="全螢幕">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/>
                                <line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- 影片播放區域 -->
                <div id="videoContainer" style="flex:1;background:#000;display:flex;align-items:center;justify-content:center;">
                    ${playerContent}
                </div>

                <!-- 底部資訊列 -->
                <div style="padding:1.5rem;background:var(--charcoal);color:var(--cream);">
                    <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:2rem;">
                        <div style="flex:1;">
                            <h3 style="font-size:1.25rem;margin-bottom:0.5rem;">${video.title}</h3>
                            <p style="font-size:0.9rem;opacity:0.7;margin-bottom:1rem;">${video.description}</p>
                            <div style="display:flex;gap:1.5rem;font-size:0.85rem;">
                                <span>
                                    <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:4px;">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                                    </svg>
                                    ${video.views} 觀看
                                </span>
                                <span>
                                    <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:4px;">
                                        <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                                    </svg>
                                    ${video.duration}
                                </span>
                                <span id="videoProgressText" style="color:var(--olive-light);">
                                    進度: ${video.progress}%
                                </span>
                            </div>
                        </div>
                        <div style="display:flex;flex-direction:column;gap:0.5rem;">
                            <button onclick="markVideoComplete('${videoId}')" style="padding:0.75rem 1.5rem;background:var(--olive);color:var(--cream);border:none;border-radius:8px;cursor:pointer;font-weight:500;white-space:nowrap;">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:4px;">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                標記完成
                            </button>
                            <button onclick="addToPlaylist('${videoId}')" style="padding:0.75rem 1.5rem;background:var(--gray-600);color:var(--cream);border:none;border-radius:8px;cursor:pointer;white-space:nowrap;">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="vertical-align:middle;margin-right:4px;">
                                    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                加入播放清單
                            </button>
                        </div>
                    </div>

                    <!-- 進度條 -->
                    <div style="margin-top:1rem;">
                        <div style="height:4px;background:var(--gray-600);border-radius:2px;overflow:hidden;">
                            <div id="videoProgressBar" style="height:100%;width:${video.progress}%;background:var(--olive);transition:width 0.3s;"></div>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';

            // 開始追蹤進度（模擬）
            startProgressTracking();

            // 鍵盤快捷鍵
            modal.addEventListener('keydown', handleVideoKeyboard);
            modal.setAttribute('tabindex', '0');
            modal.focus();
        }

        function closeVideoPlayer() {
            stopProgressTracking();
            const modal = document.getElementById('videoPlayerModal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
            }
            currentVideo = null;
        }

        function startProgressTracking() {
            if (!currentVideo) return;

            // 模擬進度更新（實際上應該從影片播放器 API 取得）
            videoProgressInterval = setInterval(() => {
                if (currentVideo && currentVideo.progress < 100) {
                    currentVideo.progress = Math.min(100, currentVideo.progress + 1);

                    const progressBar = document.getElementById('videoProgressBar');
                    const progressText = document.getElementById('videoProgressText');

                    if (progressBar) progressBar.style.width = currentVideo.progress + '%';
                    if (progressText) progressText.textContent = `進度: ${currentVideo.progress}%`;

                    // 更新本地資料
                    if (videoData[currentVideo.id]) {
                        videoData[currentVideo.id].progress = currentVideo.progress;
                    }
                }
            }, 3000); // 每 3 秒更新一次（模擬）
        }

        function stopProgressTracking() {
            if (videoProgressInterval) {
                clearInterval(videoProgressInterval);
                videoProgressInterval = null;
            }
        }

        function markVideoComplete(videoId) {
            if (videoData[videoId]) {
                videoData[videoId].progress = 100;
            }
            if (currentVideo && currentVideo.id === videoId) {
                currentVideo.progress = 100;
            }

            const progressBar = document.getElementById('videoProgressBar');
            const progressText = document.getElementById('videoProgressText');

            if (progressBar) progressBar.style.width = '100%';
            if (progressText) progressText.textContent = '進度: 100%';

            showToast('已標記為完成！');

            // 更新影片卡片的進度條
            updateVideoCardProgress(videoId, 100);
        }

        function updateVideoCardProgress(videoId, progress) {
            const cards = document.querySelectorAll('#videoGrid .video-card');
            // 根據 onclick 屬性找到對應的卡片
            cards.forEach(card => {
                if (card.getAttribute('onclick')?.includes(videoId)) {
                    const progressBar = card.querySelector('.video-progress > div');
                    if (progressBar) {
                        progressBar.style.width = progress + '%';
                    }
                }
            });
        }

        function addToPlaylist(videoId) {
            showToast('已加入播放清單！');
        }

        function toggleVideoFullscreen() {
            const container = document.getElementById('videoContainer');
            if (!container) return;

            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                container.requestFullscreen().catch(err => {
                    showToast('無法進入全螢幕模式');
                });
            }
        }

        function handleVideoKeyboard(e) {
            switch(e.key) {
                case 'Escape':
                    closeVideoPlayer();
                    break;
                case 'f':
                case 'F':
                    toggleVideoFullscreen();
                    break;
            }
        }

        function filterVideos() {
            const search = document.getElementById('videoSearch').value.toLowerCase();
            const category = document.getElementById('videoCategory').value;
            const duration = document.getElementById('videoDuration').value;

            const cards = document.querySelectorAll('#videoGrid .video-card');
            cards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const matchesSearch = !search || title.includes(search);
                card.style.display = matchesSearch ? 'block' : 'none';
            });
        }

        // ========== 測驗題庫功能 ==========
        function switchQuizTab(btn, tabName) {
            document.querySelectorAll('.quiz-tab').forEach(t => {
                t.style.background = 'var(--gray-100)';
                t.style.color = 'var(--gray-600)';
            });
            btn.style.background = 'var(--olive)';
            btn.style.color = 'var(--cream)';

            // 根據分頁篩選測驗
            const filters = {};
            if (tabName === 'progress') filters.status = 'in_progress';
            else if (tabName === 'completed') filters.status = 'completed';
            else if (tabName === 'not_started') filters.status = 'not_started';

            App.loadQuizzes(filters);
        }

        // 使用 App 的測驗功能
        function startQuiz(quizId) {
            App.startQuiz(quizId);
        }

        function viewQuizResult(quizId) {
            App.startQuiz(quizId);
        }

        function closeQuiz() {
            App.closeQuiz();
        }

        // ========== 互動討論功能 ==========
        function switchDiscTab(btn, tabName) {
            document.querySelectorAll('.disc-tab').forEach(t => {
                t.style.background = 'var(--gray-100)';
                t.style.color = 'var(--gray-600)';
            });
            btn.style.background = 'var(--olive)';
            btn.style.color = 'var(--cream)';
            showToast(`顯示${btn.textContent}`);
        }

        function openNewPostModal() {
            const modal = document.createElement('div');
            modal.id = 'newPostModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="width:90%;max-width:600px;background:var(--cream);border-radius:16px;overflow:hidden;">
                    <div style="padding:1.5rem 2rem;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:center;">
                        <h2 style="font-size:1.25rem;">發起新討論</h2>
                        <button onclick="closeNewPostModal()" style="background:none;border:none;cursor:pointer;font-size:1.5rem;color:var(--gray-400);">×</button>
                    </div>
                    <div style="padding:2rem;">
                        <div style="margin-bottom:1.5rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;color:var(--charcoal);">標題</label>
                            <input type="text" placeholder="請輸入討論標題..." style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;">
                        </div>
                        <div style="margin-bottom:1.5rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;color:var(--charcoal);">分類</label>
                            <select style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;">
                                <option>教學心得</option>
                                <option>教學工具</option>
                                <option>課程設計</option>
                                <option>企業培訓</option>
                                <option>其他</option>
                            </select>
                        </div>
                        <div style="margin-bottom:1.5rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;color:var(--charcoal);">內容</label>
                            <textarea rows="6" placeholder="請輸入討論內容..." style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;resize:vertical;"></textarea>
                        </div>
                    </div>
                    <div style="padding:1rem 2rem;border-top:1px solid var(--gray-200);display:flex;justify-content:flex-end;gap:0.75rem;">
                        <button onclick="closeNewPostModal()" style="padding:0.75rem 1.5rem;background:var(--gray-200);border:none;border-radius:8px;cursor:pointer;">取消</button>
                        <button onclick="submitNewPost()" style="padding:0.75rem 1.5rem;background:var(--olive);color:var(--cream);border:none;border-radius:8px;cursor:pointer;font-weight:500;">發布討論</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) closeNewPostModal(); };
        }

        function closeNewPostModal() {
            const modal = document.getElementById('newPostModal');
            if (modal) modal.remove();
        }

        function submitNewPost() {
            showToast('討論已發布！');
            closeNewPostModal();
        }

        function likePost(postId) {
            showToast('已按讚！');
        }

        function toggleReplies(postId) {
            showToast('正在載入回覆...');
        }

        // ========== 諮詢服務功能 ==========
        function openNewConsultationModal() {
            document.getElementById('newConsultationModal').style.display = 'flex';
        }

        function closeNewConsultationModal() {
            document.getElementById('newConsultationModal').style.display = 'none';
            document.getElementById('consultationForm').reset();
        }

        async function submitConsultation(event) {
            if (event) event.preventDefault();

            const data = {
                requestType: document.getElementById('consultationType').value,
                title: document.getElementById('consultationTitle').value,
                description: document.getElementById('consultationDescription').value,
                gradeLevel: document.getElementById('consultationGrade').value,
                estimatedBudget: document.getElementById('consultationBudget').value
            };

            if (!data.requestType || !data.title || !data.description) {
                showToast('請填寫必填欄位');
                return;
            }

            const success = await App.createConsultation(data);
            if (success) {
                closeNewConsultationModal();
            }
        }

        function switchConsultTab(btn, filter) {
            document.querySelectorAll('.consult-tab').forEach(t => {
                t.style.background = 'var(--gray-100)';
                t.style.color = 'var(--gray-600)';
            });
            btn.style.background = 'var(--olive)';
            btn.style.color = 'var(--cream)';

            // 根據篩選條件載入諮詢
            if (filter === 'all') {
                App.loadConsultations();
            } else {
                App.loadConsultations({ status: filter });
            }
        }

        // ========== 設定頁面功能 ==========
        async function saveProfile() {
            const data = {
                displayName: document.getElementById('settingsName').value.trim(),
                organization: document.getElementById('settingsOrganization').value.trim()
            };

            if (!data.displayName) {
                showToast('請輸入姓名');
                return;
            }

            await App.updateProfile(data);
        }

        async function saveNotificationSettings() {
            const settings = {
                newMaterial: document.getElementById('notifyNewMaterial').checked,
                progress: document.getElementById('notifyProgress').checked,
                expiry: document.getElementById('notifyExpiry').checked,
                email: document.getElementById('notifyEmail').checked
            };

            await App.updateNotificationSettings(settings);
        }

        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('請填寫所有密碼欄位');
                return;
            }

            if (newPassword.length < 6) {
                showToast('新密碼至少需要 6 個字元');
                return;
            }

            if (newPassword !== confirmPassword) {
                showToast('新密碼與確認密碼不相符');
                return;
            }

            const success = await App.changePassword(currentPassword, newPassword);
            if (success) {
                // 清空密碼欄位
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            }
        }

        // 頁面切換時載入對應資料
        const originalShowView = showView;
        showView = function(viewName) {
            originalShowView(viewName);

            // 根據視圖載入相應資料
            // 注意：consultations 視圖現已由 chat.js 處理
            if (viewName === 'discussions') {
                App.loadDiscussions();
            } else if (viewName === 'classes' || viewName === 'studentClasses') {
                App.loadClasses();
            } else if (viewName === 'quizzes') {
                App.loadQuizzes();
            } else if (viewName === 'settings') {
                // 進入設定頁面時重新載入用戶資料
                const user = API.getCurrentUser();
                if (user) {
                    App.updateSettingsUI(user);
                }
            }
        };

        function openReplyModal(postId) {
            const modal = document.createElement('div');
            modal.id = 'replyModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="width:90%;max-width:500px;background:var(--cream);border-radius:16px;overflow:hidden;">
                    <div style="padding:1.5rem 2rem;border-bottom:1px solid var(--gray-200);">
                        <h3>回覆討論</h3>
                    </div>
                    <div style="padding:2rem;">
                        <textarea rows="4" placeholder="輸入您的回覆..." style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;resize:vertical;"></textarea>
                    </div>
                    <div style="padding:1rem 2rem;border-top:1px solid var(--gray-200);display:flex;justify-content:flex-end;gap:0.75rem;">
                        <button onclick="closeReplyModal()" style="padding:0.75rem 1.5rem;background:var(--gray-200);border:none;border-radius:8px;cursor:pointer;">取消</button>
                        <button onclick="submitReply()" style="padding:0.75rem 1.5rem;background:var(--olive);color:var(--cream);border:none;border-radius:8px;cursor:pointer;font-weight:500;">送出回覆</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) closeReplyModal(); };
        }

        function closeReplyModal() {
            const modal = document.getElementById('replyModal');
            if (modal) modal.remove();
        }

        function submitReply() {
            showToast('回覆已送出！');
            closeReplyModal();
        }

        // ===== 橋隊管理功能（建橋者用）=====
        let classesCache = [];

        // 載入橋隊列表
        async function loadClasses() {
            try {
                const result = await API.classes.list();
                if (result.success) {
                    classesCache = result.data || [];
                    renderClassesList();
                }
            } catch (error) {
                console.error('Load classes error:', error);
                showToast('載入橋隊失敗');
            }
        }

        // 渲染橋隊列表
        function renderClassesList() {
            const container = document.getElementById('classesListContainer');
            const user = API.getCurrentUser();
            const userId = user?.userId;

            // 只顯示建橋者自己創建的橋隊
            const filtered = classesCache.filter(c => c.teacherId === userId);

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem; color: var(--gray-400);">
                        <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                            <path d="M16 3.13a4 4 0 010 7.75"/>
                        </svg>
                        <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">
                            您尚未搭建任何橋
                        </p>
                        <p style="font-size: 0.9rem;">
                            點擊「搭建新橋」開始管理您的探橋者
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
                    ${filtered.map(cls => `
                        <div class="class-card" onclick="openClassDetail('${cls.classId}')" style="background: var(--white); border-radius: 16px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.06); cursor: pointer; transition: all 0.2s;">
                            <div style="height: 8px; background: ${getClassColor(cls.subject)};"></div>
                            <div style="padding: 1.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                                    <div>
                                        <h3 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 0.25rem;">${cls.name}</h3>
                                        <p style="font-size: 0.85rem; color: var(--gray-500);">${cls.subject || '一般課程'}</p>
                                    </div>
                                    ${cls.isEnrolled ? '<span style="background: var(--olive); color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">已加入</span>' : ''}
                                </div>
                                <p style="font-size: 0.9rem; color: var(--gray-600); margin-bottom: 1rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${cls.description || '尚無說明'}</p>
                                <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid var(--gray-100);">
                                    <div style="display: flex; gap: 1.5rem; font-size: 0.85rem; color: var(--gray-500);">
                                        <span style="display: flex; align-items: center; gap: 0.25rem;">
                                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
                                            ${cls.memberCount || 0} 位探橋者
                                        </span>
                                        <span style="display: flex; align-items: center; gap: 0.25rem;">
                                            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/></svg>
                                            ${cls.assignmentCount || 0} 項作業
                                        </span>
                                    </div>
                                    <span style="font-size: 0.8rem; color: var(--gray-400);">${cls.teacherName || '建橋者'}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 橋隊顏色
        function getClassColor(subject) {
            const colors = {
                '數學': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                '英文': 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                '國文': 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                '自然': 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                '社會': 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                '程式': 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)'
            };
            return colors[subject] || 'linear-gradient(135deg, var(--olive) 0%, var(--olive-deep) 100%)';
        }

        // 開啟搭建新橋 Modal
        function openCreateClassModal() {
            const modal = document.createElement('div');
            modal.id = 'createClassModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="width:90%;max-width:500px;background:var(--cream);border-radius:16px;overflow:hidden;">
                    <div style="padding:1.5rem 2rem;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:center;">
                        <h3 style="font-size:1.2rem;font-weight:600;">搭建新橋</h3>
                        <button onclick="closeCreateClassModal()" style="background:none;border:none;cursor:pointer;padding:0.5rem;">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                    <div style="padding:2rem;">
                        <div style="margin-bottom:1.25rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;">橋樑名稱 *</label>
                            <input type="text" id="newClassName" placeholder="例如：九年級數學橋" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;">
                        </div>
                        <div style="margin-bottom:1.25rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;">科目</label>
                            <input type="text" id="newClassSubject" placeholder="例如：數學、英文、程式設計" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;">
                        </div>
                        <div style="margin-bottom:1.25rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;">橋樑說明</label>
                            <textarea id="newClassDesc" rows="3" placeholder="輸入橋樑說明（選填）" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;resize:vertical;"></textarea>
                        </div>
                    </div>
                    <div style="padding:1rem 2rem;border-top:1px solid var(--gray-200);display:flex;justify-content:flex-end;gap:0.75rem;">
                        <button onclick="closeCreateClassModal()" style="padding:0.75rem 1.5rem;background:var(--gray-200);border:none;border-radius:8px;cursor:pointer;">取消</button>
                        <button onclick="submitCreateClass()" style="padding:0.75rem 1.5rem;background:var(--olive);color:var(--cream);border:none;border-radius:8px;cursor:pointer;font-weight:500;">搭建橋樑</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) closeCreateClassModal(); };
        }

        function closeCreateClassModal() {
            const modal = document.getElementById('createClassModal');
            if (modal) modal.remove();
        }

        async function submitCreateClass() {
            const name = document.getElementById('newClassName').value.trim();
            const subject = document.getElementById('newClassSubject').value;
            const description = document.getElementById('newClassDesc').value.trim();

            if (!name) {
                showToast('請輸入橋樑名稱');
                return;
            }

            try {
                const result = await API.classes.create({ name, subject, description });
                if (result.success) {
                    showToast('橋樑已搭建！通行碼：' + result.data.inviteCode);
                    closeCreateClassModal();
                    loadClasses();
                } else {
                    showToast(result.message || '搭建橋樑失敗');
                }
            } catch (error) {
                console.error('Create class error:', error);
                showToast('搭建橋樑失敗');
            }
        }

        // 開啟橋隊詳情
        async function openClassDetail(classId) {
            try {
                const result = await API.classes.get(classId);
                if (!result.success) {
                    showToast('載入橋隊詳情失敗');
                    return;
                }

                const cls = result.data;
                const user = API.getCurrentUser();
                const isTeacher = cls.teacherId === user?.userId;

                const detailContent = document.getElementById('classDetailContent');
                detailContent.innerHTML = `
                    <!-- 橋隊標題 -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button onclick="showView('classes')" style="background: var(--gray-100); border: none; padding: 0.5rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center;">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"/></svg>
                            </button>
                            <div>
                                <h2 style="font-size: 1.5rem; font-weight: 600;">${cls.name}</h2>
                                <p style="color: var(--gray-500);">${cls.subject || '一般課程'} · ${cls.teacherName || '建橋者'}</p>
                            </div>
                        </div>
                        ${isTeacher ? `
                            <div style="display: flex; gap: 0.75rem;">
                                <div style="background: var(--gray-100); padding: 0.75rem 1.25rem; border-radius: 8px;">
                                    <span style="color: var(--gray-500); font-size: 0.85rem;">通行碼：</span>
                                    <strong style="font-size: 1.1rem; letter-spacing: 0.1rem;">${cls.inviteCode}</strong>
                                    <button onclick="copyInviteCode('${cls.inviteCode}')" style="background: none; border: none; cursor: pointer; margin-left: 0.5rem;">
                                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                                    </button>
                                </div>
                                <button onclick="openAddAssignmentModal('${classId}')" style="padding: 0.75rem 1.5rem; background: var(--olive); color: var(--cream); border: none; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 0.5rem;">
                                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                                    新增作業
                                </button>
                            </div>
                        ` : ''}
                    </div>

                    <!-- 橋隊統計 -->
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem;">
                        <div style="background: var(--white); padding: 1.25rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--olive);">${cls.memberCount || 0}</div>
                            <div style="font-size: 0.85rem; color: var(--gray-500);">橋隊成員</div>
                        </div>
                        <div style="background: var(--white); padding: 1.25rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: 700; color: var(--terracotta);">${(cls.assignments || []).filter(a => a.type === 'material').length}</div>
                            <div style="font-size: 0.85rem; color: var(--gray-500);">建材</div>
                        </div>
                        <div style="background: var(--white); padding: 1.25rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: 700; color: #6366f1;">${(cls.assignments || []).filter(a => a.type === 'quiz' || a.type === 'practice').length}</div>
                            <div style="font-size: 0.85rem; color: var(--gray-500);">測驗/練習</div>
                        </div>
                        <div style="background: var(--white); padding: 1.25rem; border-radius: 12px; text-align: center;">
                            <div style="font-size: 1.75rem; font-weight: 700; color: #10b981;">${(cls.assignments || []).filter(a => a.type === 'exam').length}</div>
                            <div style="font-size: 0.85rem; color: var(--gray-500);">考試</div>
                        </div>
                    </div>

                    <!-- 分頁標籤 -->
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--gray-200); padding-bottom: 0.5rem;">
                        <button class="detail-tab active" onclick="switchDetailTab(this, 'assignments')" style="padding: 0.75rem 1.5rem; border: none; background: var(--olive); color: var(--cream); border-radius: 8px 8px 0 0; cursor: pointer; font-weight: 500;">作業與建材</button>
                        ${isTeacher ? `<button class="detail-tab" onclick="switchDetailTab(this, 'members')" style="padding: 0.75rem 1.5rem; border: none; background: var(--gray-100); color: var(--gray-600); border-radius: 8px 8px 0 0; cursor: pointer;">橋隊成員</button>` : ''}
                    </div>

                    <!-- 作業列表 -->
                    <div id="assignmentsPanel">
                        ${renderAssignmentsList(cls.assignments || [], isTeacher, classId)}
                    </div>

                    <!-- 成員列表（建橋者可見）-->
                    <div id="membersPanel" style="display: none;">
                        ${isTeacher ? renderMembersList(cls.members || [], classId) : ''}
                    </div>
                `;

                showView('classDetail');

            } catch (error) {
                console.error('Open class detail error:', error);
                showToast('載入橋隊詳情失敗');
            }
        }

        // 渲染作業列表
        function renderAssignmentsList(assignments, isTeacher, classId) {
            if (assignments.length === 0) {
                return `
                    <div style="text-align: center; padding: 3rem; color: var(--gray-400);">
                        <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/>
                        </svg>
                        <p>尚無作業或建材</p>
                        ${isTeacher ? '<p style="font-size: 0.85rem; margin-top: 0.5rem;">點擊「新增作業」開始指派</p>' : ''}
                    </div>
                `;
            }

            const typeLabels = { 'material': '建材', 'quiz': '測驗', 'practice': '練習', 'exam': '考試' };
            const typeColors = { 'material': 'var(--olive)', 'quiz': '#6366f1', 'practice': '#10b981', 'exam': 'var(--terracotta)' };

            return `
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    ${assignments.map(a => `
                        <div style="background: var(--white); border-radius: 12px; padding: 1.25rem; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div style="width: 48px; height: 48px; background: ${typeColors[a.type]}20; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                    <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="${typeColors[a.type]}" stroke-width="2">
                                        ${a.type === 'material' ? '<path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/>' : ''}
                                        ${a.type === 'quiz' || a.type === 'practice' ? '<circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/>' : ''}
                                        ${a.type === 'exam' ? '<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/>' : ''}
                                    </svg>
                                </div>
                                <div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                        <span style="background: ${typeColors[a.type]}; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem;">${typeLabels[a.type]}</span>
                                        <h4 style="font-weight: 600;">${a.title}</h4>
                                    </div>
                                    <p style="font-size: 0.85rem; color: var(--gray-500);">
                                        ${a.description || '無說明'}
                                        ${a.dueDate ? ` · 截止：${new Date(a.dueDate).toLocaleDateString('zh-TW')}` : ''}
                                        ${a.points ? ` · ${a.points} 分` : ''}
                                    </p>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button onclick="viewAssignment('${a.assignmentId}')" style="padding: 0.5rem 1rem; background: var(--gray-100); border: none; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">查看</button>
                                ${isTeacher ? `<button onclick="deleteAssignment('${classId}', '${a.assignmentId}')" style="padding: 0.5rem; background: none; border: none; cursor: pointer; color: var(--gray-400);"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3,6 5,6 21,6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg></button>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 渲染成員列表
        function renderMembersList(members, classId) {
            if (members.length === 0) {
                return `
                    <div style="text-align: center; padding: 3rem; color: var(--gray-400);">
                        <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/>
                        </svg>
                        <p>尚無探橋者加入</p>
                        <p style="font-size: 0.85rem; margin-top: 0.5rem;">分享通行碼讓探橋者加入橋隊</p>
                    </div>
                `;
            }

            return `
                <div style="background: var(--white); border-radius: 12px; overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: var(--gray-50);">
                            <tr>
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">探橋者</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">電子郵件</th>
                                <th style="padding: 1rem; text-align: left; font-weight: 600;">加入日期</th>
                                <th style="padding: 1rem; text-align: center; font-weight: 600;">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${members.map(m => `
                                <tr style="border-top: 1px solid var(--gray-100);">
                                    <td style="padding: 1rem;">
                                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                                            <div style="width: 36px; height: 36px; background: var(--olive); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--cream); font-weight: 600;">${(m.userName || '學')[0]}</div>
                                            <span>${m.userName || '探橋者'}</span>
                                        </div>
                                    </td>
                                    <td style="padding: 1rem; color: var(--gray-500);">${m.userEmail || '-'}</td>
                                    <td style="padding: 1rem; color: var(--gray-500);">${m.joinedAt ? new Date(m.joinedAt).toLocaleDateString('zh-TW') : '-'}</td>
                                    <td style="padding: 1rem; text-align: center;">
                                        <button onclick="removeMember('${classId}', '${m.userId}')" style="padding: 0.25rem 0.75rem; background: var(--gray-100); border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem; color: var(--terracotta);">移除</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // 切換詳情頁標籤
        function switchDetailTab(btn, panel) {
            document.querySelectorAll('.detail-tab').forEach(t => {
                t.style.background = 'var(--gray-100)';
                t.style.color = 'var(--gray-600)';
                t.classList.remove('active');
            });
            btn.style.background = 'var(--olive)';
            btn.style.color = 'var(--cream)';
            btn.classList.add('active');

            document.getElementById('assignmentsPanel').style.display = panel === 'assignments' ? 'block' : 'none';
            document.getElementById('membersPanel').style.display = panel === 'members' ? 'block' : 'none';
        }

        // 複製邀請碼
        function copyInviteCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showToast('邀請碼已複製');
            });
        }

        // 新增作業 Modal
        function openAddAssignmentModal(classId) {
            const modal = document.createElement('div');
            modal.id = 'addAssignmentModal';
            modal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:10000;display:flex;align-items:center;justify-content:center;';
            modal.innerHTML = `
                <div style="width:90%;max-width:550px;background:var(--cream);border-radius:16px;overflow:hidden;">
                    <div style="padding:1.5rem 2rem;border-bottom:1px solid var(--gray-200);display:flex;justify-content:space-between;align-items:center;">
                        <h3 style="font-size:1.2rem;font-weight:600;">新增作業/建材</h3>
                        <button onclick="closeAddAssignmentModal()" style="background:none;border:none;cursor:pointer;padding:0.5rem;">
                            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        </button>
                    </div>
                    <div style="padding:2rem;">
                        <div style="margin-bottom:1.25rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;">類型 *</label>
                            <select id="assignmentType" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;background:white;">
                                <option value="material">建材</option>
                                <option value="quiz">測驗</option>
                                <option value="practice">練習</option>
                                <option value="exam">考試</option>
                            </select>
                        </div>
                        <div style="margin-bottom:1.25rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;">標題 *</label>
                            <input type="text" id="assignmentTitle" placeholder="例如：第一章講義" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;">
                        </div>
                        <div style="margin-bottom:1.25rem;">
                            <label style="display:block;margin-bottom:0.5rem;font-weight:500;">說明</label>
                            <textarea id="assignmentDesc" rows="2" placeholder="輸入說明（選填）" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;resize:vertical;"></textarea>
                        </div>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
                            <div>
                                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">截止日期</label>
                                <input type="date" id="assignmentDue" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;">
                            </div>
                            <div>
                                <label style="display:block;margin-bottom:0.5rem;font-weight:500;">分數</label>
                                <input type="number" id="assignmentPoints" placeholder="0" min="0" style="width:100%;padding:0.75rem 1rem;border:1px solid var(--gray-200);border-radius:8px;font-size:1rem;">
                            </div>
                        </div>
                    </div>
                    <div style="padding:1rem 2rem;border-top:1px solid var(--gray-200);display:flex;justify-content:flex-end;gap:0.75rem;">
                        <button onclick="closeAddAssignmentModal()" style="padding:0.75rem 1.5rem;background:var(--gray-200);border:none;border-radius:8px;cursor:pointer;">取消</button>
                        <button onclick="submitAddAssignment('${classId}')" style="padding:0.75rem 1.5rem;background:var(--olive);color:var(--cream);border:none;border-radius:8px;cursor:pointer;font-weight:500;">新增</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) closeAddAssignmentModal(); };
        }

        function closeAddAssignmentModal() {
            const modal = document.getElementById('addAssignmentModal');
            if (modal) modal.remove();
        }

        async function submitAddAssignment(classId) {
            const type = document.getElementById('assignmentType').value;
            const title = document.getElementById('assignmentTitle').value.trim();
            const description = document.getElementById('assignmentDesc').value.trim();
            const dueDate = document.getElementById('assignmentDue').value || null;
            const points = parseInt(document.getElementById('assignmentPoints').value) || 0;

            if (!title) {
                showToast('請輸入標題');
                return;
            }

            try {
                const result = await API.classes.createAssignment(classId, { type, title, description, dueDate, points });
                if (result.success) {
                    showToast('作業已新增');
                    closeAddAssignmentModal();
                    openClassDetail(classId);
                } else {
                    showToast(result.message || '新增作業失敗');
                }
            } catch (error) {
                console.error('Add assignment error:', error);
                showToast('新增作業失敗');
            }
        }

        // 刪除作業
        async function deleteAssignment(classId, assignmentId) {
            if (!confirm('確定要刪除此作業嗎？')) return;

            try {
                const result = await API.classes.deleteAssignment(classId, assignmentId);
                if (result.success) {
                    showToast('作業已刪除');
                    openClassDetail(classId);
                } else {
                    showToast(result.message || '刪除作業失敗');
                }
            } catch (error) {
                console.error('Delete assignment error:', error);
                showToast('刪除作業失敗');
            }
        }

        // 移除成員
        async function removeMember(classId, userId) {
            if (!confirm('確定要移除此成員嗎？')) return;

            try {
                const result = await API.classes.removeMember(classId, userId);
                if (result.success) {
                    showToast('成員已移除');
                    openClassDetail(classId);
                } else {
                    showToast(result.message || '移除成員失敗');
                }
            } catch (error) {
                console.error('Remove member error:', error);
                showToast('移除成員失敗');
            }
        }

        // 查看作業
        function viewAssignment(assignmentId) {
            showToast('正在載入作業內容...');
            // 這裡可以擴展為打開作業詳情
        }

        // ===== 探橋者橋隊功能 =====

        // 開啟探橋者加入橋隊 Modal
        function openStudentJoinClassModal() {
            document.getElementById('studentJoinClassModal').style.display = 'flex';
            document.getElementById('studentInviteCodeInput').value = '';
            document.getElementById('studentInviteCodeInput').focus();
        }

        // 關閉探橋者加入橋隊 Modal
        function closeStudentJoinClassModal() {
            document.getElementById('studentJoinClassModal').style.display = 'none';
        }

        // 提交加入橋隊
        async function submitStudentJoinClass() {
            const code = document.getElementById('studentInviteCodeInput').value.trim().toUpperCase();
            if (!code || code.length < 6) {
                showToast('請輸入有效的邀請碼');
                return;
            }

            try {
                const result = await API.classes.joinByCode(code);
                if (result.success) {
                    showToast('成功加入橋隊：' + result.data.className);
                    closeStudentJoinClassModal();
                    loadStudentClasses();
                } else {
                    showToast(result.message || '加入橋隊失敗');
                }
            } catch (error) {
                console.error('Join class error:', error);
                showToast('加入橋隊失敗');
            }
        }

        // 載入探橋者已加入的橋隊
        async function loadStudentClasses() {
            const container = document.getElementById('studentClassesList');
            if (!container) return;

            try {
                const result = await API.classes.list('enrolled');
                if (!result.success) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 4rem 2rem; color: var(--gray-400);">
                            <p>載入橋隊失敗，請重試</p>
                        </div>
                    `;
                    return;
                }

                const classes = result.data || [];

                if (classes.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 4rem 2rem; color: var(--gray-400);">
                            <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                                <path d="M16 3.13a4 4 0 010 7.75"/>
                            </svg>
                            <p style="font-size: 1.1rem; margin-bottom: 0.5rem;">尚未加入任何橋隊</p>
                            <p style="font-size: 0.9rem; color: var(--gray-400);">請點擊上方「加入新橋隊」輸入建橋者提供的通行碼</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = `
                    <div style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));">
                        ${classes.map(cls => `
                            <div onclick="openStudentClassDetail('${cls.classId}')" style="background: var(--white); border-radius: 12px; padding: 1.5rem; cursor: pointer; transition: all 0.2s; border: 1px solid var(--gray-100);" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                                <div style="display: flex; align-items: flex-start; gap: 1rem;">
                                    <div style="width: 48px; height: 48px; background: linear-gradient(135deg, var(--olive) 0%, var(--olive-light) 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="var(--cream)" stroke-width="2">
                                            <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
                                            <circle cx="9" cy="7" r="4"/>
                                            <path d="M23 21v-2a4 4 0 00-3-3.87"/>
                                            <path d="M16 3.13a4 4 0 010 7.75"/>
                                        </svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.25rem;">${cls.name}</h3>
                                        <p style="color: var(--gray-500); font-size: 0.85rem; margin-bottom: 0.5rem;">${cls.subject || '一般課程'}</p>
                                        <p style="color: var(--gray-400); font-size: 0.8rem;">
                                            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 0.25rem;"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                            ${cls.teacherName || '建橋者'}
                                        </p>
                                    </div>
                                </div>
                                <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--gray-100); display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 0.8rem; color: var(--gray-400);">
                                        加入時間：${cls.joinedAt ? new Date(cls.joinedAt).toLocaleDateString('zh-TW') : '-'}
                                    </span>
                                    <span style="font-size: 0.8rem; color: var(--olive); font-weight: 500;">
                                        查看詳情 →
                                    </span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

            } catch (error) {
                console.error('Load student classes error:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 4rem 2rem; color: var(--gray-400);">
                        <p>載入橋隊失敗，請重試</p>
                    </div>
                `;
            }
        }

        // 開啟探橋者橋隊詳情（顯示作業列表）
        async function openStudentClassDetail(classId) {
            try {
                const result = await API.classes.get(classId);
                if (!result.success) {
                    showToast('載入橋隊詳情失敗');
                    return;
                }

                const cls = result.data;

                const detailContent = document.getElementById('classDetailContent');
                detailContent.innerHTML = `
                    <!-- 橋隊標題 -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <button onclick="showView('studentClasses')" style="background: var(--gray-100); border: none; padding: 0.5rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center;">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15,18 9,12 15,6"/></svg>
                            </button>
                            <div>
                                <h2 style="font-size: 1.5rem; font-weight: 600;">${cls.name}</h2>
                                <p style="color: var(--gray-500);">${cls.subject || '一般課程'} · ${cls.teacherName || '建橋者'}</p>
                            </div>
                        </div>
                    </div>

                    <!-- 作業列表 -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">橋隊作業</h2>
                        </div>
                        <div class="card-body">
                            ${renderStudentAssignmentsList(cls.assignments || [])}
                        </div>
                    </div>
                `;

                showView('classDetail');

            } catch (error) {
                console.error('Load student class detail error:', error);
                showToast('載入橋隊詳情失敗');
            }
        }

        // 渲染探橋者作業列表
        function renderStudentAssignmentsList(assignments) {
            if (assignments.length === 0) {
                return `
                    <div style="text-align: center; padding: 3rem; color: var(--gray-400);">
                        <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1" style="margin-bottom: 1rem; opacity: 0.5;">
                            <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <p>目前沒有作業</p>
                    </div>
                `;
            }

            const typeIcons = {
                'video': '<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23,7 16,12 23,17"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>',
                'quiz': '<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>',
                'practice': '<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>',
                'exam': '<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M9 15l2 2 4-4"/></svg>'
            };

            const typeLabels = { 'video': '影片', 'quiz': '測驗', 'practice': '練習', 'exam': '考試' };
            const typeColors = { 'video': '#4A7C59', 'quiz': '#C17A5E', 'practice': '#6B7F3A', 'exam': '#8B5A2B' };

            return `
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    ${assignments.map(a => `
                        <div onclick="startAssignment('${a.assignmentId}', '${a.type}')" style="display: flex; align-items: center; gap: 1rem; padding: 1rem 1.25rem; background: var(--gray-50); border-radius: 8px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='var(--gray-100)'" onmouseout="this.style.background='var(--gray-50)'">
                            <div style="width: 40px; height: 40px; background: ${typeColors[a.type] || 'var(--olive)'}20; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: ${typeColors[a.type] || 'var(--olive)'};">
                                ${typeIcons[a.type] || typeIcons['video']}
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                                    <span style="font-size: 0.75rem; padding: 0.15rem 0.5rem; background: ${typeColors[a.type] || 'var(--olive)'}; color: white; border-radius: 4px;">${typeLabels[a.type] || '作業'}</span>
                                    <span style="font-weight: 600;">${a.title}</span>
                                </div>
                                <div style="display: flex; gap: 1rem; font-size: 0.8rem; color: var(--gray-500);">
                                    ${a.dueDate ? `<span>截止：${new Date(a.dueDate).toLocaleDateString('zh-TW')}</span>` : ''}
                                    ${a.points ? `<span>分數：${a.points} 分</span>` : ''}
                                </div>
                            </div>
                            <div style="color: var(--olive);">
                                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9,18 15,12 9,6"/></svg>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 開始作業
        function startAssignment(assignmentId, type) {
            // 根據類型跳轉到不同視圖
            switch (type) {
                case 'video':
                    showView('videos');
                    showToast('正在載入影片...');
                    break;
                case 'quiz':
                case 'practice':
                    showView('quizzes');
                    showToast('正在載入測驗...');
                    break;
                case 'exam':
                    showView('quizzes');
                    showToast('正在載入考試...');
                    break;
                default:
                    showToast('正在載入作業內容...');
            }
        }

        // Search functionality
        const searchInput = document.querySelector('.search-box input');
        const searchBox = document.querySelector('.search-box');

        // Create search results container
        const searchResults = document.createElement('div');
        searchResults.className = 'search-results';
        searchBox.appendChild(searchResults);

        searchInput.addEventListener('focus', () => {
            searchResults.innerHTML = resources.map(r => `
                <div class="search-result-item" onclick="openResourceModal(${r.id})">
                    <div class="result-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg></div>
                    <div><strong>${r.title}</strong><br><small style="color:var(--gray-500)">${r.type} · ${r.author}</small></div>
                </div>
            `).join('');
            searchResults.classList.add('active');
        });

        searchInput.addEventListener('blur', () => {
            setTimeout(() => searchResults.classList.remove('active'), 200);
        });

        searchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            const filtered = resources.filter(r =>
                r.title.toLowerCase().includes(query) ||
                r.tags.some(t => t.toLowerCase().includes(query))
            );
            searchResults.innerHTML = filtered.length ? filtered.map(r => `
                <div class="search-result-item" onclick="openResourceModal(${r.id})">
                    <div class="result-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg></div>
                    <div><strong>${r.title}</strong><br><small style="color:var(--gray-500)">${r.type} · ${r.author}</small></div>
                </div>
            `).join('') : '<div style="padding: 1rem; color: var(--gray-500);">找不到相關結果</div>';
        });

        // Notification button
        document.querySelector('.icon-btn').addEventListener('click', toggleNotifications);

        // Resource cards click
        document.querySelectorAll('.resource-card').forEach((card, index) => {
            card.addEventListener('click', () => openResourceModal(index + 1));
        });

        // Course items click
        document.querySelectorAll('.course-item').forEach(item => {
            item.addEventListener('click', function() {
                const title = this.querySelector('.course-title').textContent;
                openCourseModal(title);
            });
        });

        // Quick action buttons
        document.querySelectorAll('.quick-action-btn').forEach((btn, index) => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                if (index === 0) {
                    document.querySelectorAll('.nav-item')[1].click();
                } else {
                    showToast('已發送聯絡請求給顧問團隊！');
                }
            });
        });

        // Card action links
        document.querySelectorAll('.card-action').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.nav-item')[2].click();
            });
        });

        // Close modals on overlay click
        document.getElementById('modalOverlay').addEventListener('click', () => {
            closeModal();
            closeCourseModal();
        });

        // Unit items in course modal
        document.querySelectorAll('.unit-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.unit-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
                showToast('正在載入單元...');
            });
        });

        // Tab switching for courses page
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const tabName = this.dataset.tab;
                showToast(`已切換至${this.textContent.split(' ')[0]}課程`);
            });
        });

        // Course cards click handlers
        document.querySelectorAll('.course-card').forEach(card => {
            card.addEventListener('click', function() {
                const title = this.querySelector('h3').textContent;
                openCourseModal(title);
            });
        });

        // User profile menu
        const userProfile = document.querySelector('.user-profile');
        const sidebarFooter = document.querySelector('.sidebar-footer');

        // Create user menu
        const userMenu = document.createElement('div');
        userMenu.className = 'user-menu';
        userMenu.innerHTML = `
            <a class="user-menu-item" onclick="showView('settings')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                建橋者檔案
            </a>
            <a class="user-menu-item" onclick="showView('logout')">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                離開橋樑
            </a>
        `;
        sidebarFooter.style.position = 'relative';
        sidebarFooter.insertBefore(userMenu, userProfile);

        userProfile.style.cursor = 'pointer';
        userProfile.addEventListener('click', () => {
            userMenu.classList.toggle('active');
        });

        // Close user menu when clicking elsewhere
        document.addEventListener('click', (e) => {
            if (!sidebarFooter.contains(e.target)) {
                userMenu.classList.remove('active');
            }
        });

        // Filter functionality for library
        document.querySelectorAll('.filter-select').forEach(select => {
            select.addEventListener('change', function() {
                const filterType = this.previousElementSibling.textContent;
                const value = this.options[this.selectedIndex].text;
                if (this.value) {
                    showToast(`已篩選: ${value}`);
                } else {
                    showToast(`已重置${filterType}篩選`);
                }
            });
        });

        // Calendar day interactions
        document.querySelectorAll('.calendar-day.has-event').forEach(day => {
            day.style.cursor = 'pointer';
            day.addEventListener('click', function() {
                const event = this.querySelector('.event-dot');
                if (event) {
                    showToast('查看行事曆事件...');
                }
            });
        });

        // Mobile menu toggle
        const mobileMenuBtn = document.createElement('button');
        mobileMenuBtn.className = 'mobile-menu-btn';
        mobileMenuBtn.innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>';

        const topBarActions = document.querySelector('.top-bar-actions');
        topBarActions.insertBefore(mobileMenuBtn, topBarActions.firstChild);

        mobileMenuBtn.addEventListener('click', () => {
            document.querySelector('.sidebar').classList.toggle('open');
        });

        // Close sidebar on mobile when nav item clicked
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth <= 768) {
                    document.querySelector('.sidebar').classList.remove('open');
                }
            });
        });

        // Activity items click
        document.querySelectorAll('.activity-item').forEach(item => {
            item.style.cursor = 'pointer';
            item.addEventListener('click', function() {
                const text = this.querySelector('.activity-text').textContent;
                showToast('正在載入詳情...');
            });
        });

        // License table row actions
        document.querySelectorAll('.data-table tbody tr').forEach(row => {
            row.style.cursor = 'pointer';
            row.addEventListener('click', function(e) {
                if (e.target.closest('.btn-icon')) return;
                const name = this.querySelector('strong')?.textContent || '建材';
                showToast(`查看「${name}」授權詳情`);
            });
        });

        // Form save handlers
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('change', function() {
                // Visual feedback that form has been modified
                const saveBtn = this.closest('.card-body')?.querySelector('.btn-primary');
                if (saveBtn) {
                    saveBtn.style.animation = 'pulse 0.5s ease';
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeCourseModal();
                document.getElementById('notificationPanel').classList.remove('active');
                userMenu.classList.remove('active');
            }
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'k') {
                    e.preventDefault();
                    searchInput.focus();
                }
            }
        });

        // Video placeholder play action
        document.querySelector('.video-placeholder')?.addEventListener('click', function() {
            this.innerHTML = '<div class="loading"><div class="spinner"></div> 正在載入影片...</div>';
            setTimeout(() => {
                this.innerHTML = `
                    <div style="text-align: center;">
                        <svg viewBox="0 0 24 24" width="64" height="64" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5,3 19,12 5,21"/></svg>
                        <p>影片播放中 (示範)</p>
                        <p style="font-size: 0.85rem; opacity: 0.7;">實際影片需要伺服器支援</p>
                    </div>
                `;
            }, 1500);
        });

        // Library search
        const librarySearch = document.getElementById('librarySearch');
        if (librarySearch) {
            librarySearch.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                document.querySelectorAll('#libraryView .resource-card').forEach(card => {
                    const title = card.querySelector('.resource-title')?.textContent.toLowerCase() || '';
                    const desc = card.querySelector('.resource-desc')?.textContent.toLowerCase() || '';
                    const tags = Array.from(card.querySelectorAll('.tag')).map(t => t.textContent.toLowerCase()).join(' ');
                    const match = title.includes(query) || desc.includes(query) || tags.includes(query);
                    card.style.display = match ? 'block' : 'none';
                });
            });
        }

        // Dashboard quick stats animation
        document.querySelectorAll('.stat-value').forEach(stat => {
            const finalValue = stat.textContent;
            const numMatch = finalValue.match(/\d+/);
            if (numMatch) {
                const num = parseInt(numMatch[0]);
                let current = 0;
                const suffix = finalValue.replace(/\d+/, '');
                const increment = Math.ceil(num / 30);
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= num) {
                        current = num;
                        clearInterval(timer);
                    }
                    stat.textContent = current + suffix;
                }, 30);
            }
        });

        // Smooth page transitions
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelector('.main-content').style.opacity = '0.5';
                setTimeout(() => {
                    document.querySelector('.main-content').style.opacity = '1';
                }, 150);
            });
        });

        // Initialize - show dashboard
        showView('dashboard');

        // 載入教材資源（在知識建材庫使用）
        loadResources();

        // ===== Login/Register Functions =====

        function switchLoginTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.login-tab');
            const errorDiv = document.getElementById('loginError');

            errorDiv.classList.remove('show');

            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        // ===== 登入/註冊切換 =====
        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabs = document.querySelectorAll('.auth-tab');
            const errorDiv = document.getElementById('loginError');

            errorDiv.classList.remove('show');
            errorDiv.textContent = '';

            if (tab === 'login') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            const btn = e.target.querySelector('button');

            btn.disabled = true;
            btn.textContent = '正在踏上橋樑...';
            errorDiv.classList.remove('show');

            try {
                const success = await App.login(email, password);
                if (!success) {
                    errorDiv.textContent = '無法踏上橋樑，請確認帳號與密碼';
                    errorDiv.classList.add('show');
                }
            } catch (error) {
                errorDiv.textContent = '橋樑暫時關閉，請稍後再試';
                errorDiv.classList.add('show');
            }

            btn.disabled = false;
            btn.textContent = '踏上橋樑';
        }

        async function handleRegister(e) {
            e.preventDefault();
            const errorDiv = document.getElementById('loginError');
            const btn = e.target.querySelector('button');

            // 探橋者需要通行碼
            const inviteCode = document.getElementById('registerInviteCode').value.trim().toUpperCase();
            if (!inviteCode || inviteCode.length < 6) {
                errorDiv.textContent = '請輸入有效的橋樑通行碼';
                errorDiv.classList.add('show');
                return;
            }

            const userData = {
                displayName: document.getElementById('registerName').value,
                email: document.getElementById('registerEmail').value,
                password: document.getElementById('registerPassword').value,
                role: 'student',
                inviteCode: inviteCode
            };

            btn.disabled = true;
            btn.textContent = '正在建立探橋者身份...';
            errorDiv.classList.remove('show');

            try {
                const success = await App.register(userData);
                if (!success) {
                    errorDiv.textContent = '無法成為探橋者，該郵箱可能已被使用或通行碼無效';
                    errorDiv.classList.add('show');
                }
            } catch (error) {
                errorDiv.textContent = '橋樑暫時關閉，請稍後再試';
                errorDiv.classList.add('show');
            }

            btn.disabled = false;
            btn.textContent = '開始探索';
        }
    </script>

    <!-- API & App Scripts -->
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    <!-- Socket.io Client -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/chat.js"></script>
</body>
</html>
